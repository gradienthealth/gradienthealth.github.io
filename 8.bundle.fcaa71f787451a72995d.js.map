{"version":3,"file":"8.bundle.fcaa71f787451a72995d.js","mappings":"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","sources":["webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelStudyBrowserTracking/PanelStudyBrowserTracking.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/utils/getImageSrcFromImageId.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/utils/requestDisplaySetCreationForStudy.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/utils/studyPanelUtilities.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelStudyBrowserTracking/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelMeasurementTableTracking/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/RatingSelector.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/GridSelector.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/Checkbox.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/Textarea.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/DisplayValue.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/fields/UserProfile.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/_shared/FormGeneratorComponent/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelForm/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelFormAndMeasurementTable/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelStudyBrowser/PanelStudyBrowser.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/panels/PanelStudyBrowser/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/getPanelModule.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/getViewportModule.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/getHangingProtocolModule.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/DicomWebDataSource/utils/getImageId.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/DicomWebDataSource/utils/getWADORSImageId.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/DicomJSONDataSource/index.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/getDataSourcesModule.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/id.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/GoogleSheetsService/utils.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/GoogleSheetsService/GoogleSheetsService.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/utils.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/CropDisplayAreaService/CropDisplayAreaService.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/CacheAPIService/CacheAPIService.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/utils/addSegmentationLabelModifier.ts","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/index.tsx","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/CropDisplayAreaService/index.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/GoogleSheetsService/index.js","webpack:///../../../../GradientExtensionsAndModes/extensions/ohif-gradienthealth-extension/src/services/CacheAPIService/index.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { utils } from '@ohif/core';\nimport {\n  StudyBrowser,\n  useImageViewer,\n  useViewportGrid,\n  Dialog,\n} from '@ohif/ui';\nimport { useNavigate } from 'react-router-dom';\n\nconst { formatDate } = utils;\n\n/**\n *\n * @param {*} param0\n */\nfunction PanelStudyBrowserTracking({\n  MeasurementService,\n  DisplaySetService,\n  UIDialogService,\n  UINotificationService,\n  getImageSrc,\n  getStudiesForPatientByMRN,\n  requestDisplaySetCreationForStudy,\n  dataSource,\n}) {\n  // Normally you nest the components so the tree isn't so deep, and the data\n  // doesn't have to have such an intense shape. This works well enough for now.\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\n  const { StudyInstanceUIDs } = useImageViewer();\n  const [\n    { activeViewportId, viewports, numCols, numRows },\n    viewportGridService,\n  ] = useViewportGrid();\n  const navigate=useNavigate()\n\n  const [activeTabName, setActiveTabName] = useState('primary');\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\n    ...StudyInstanceUIDs,\n  ]);\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\n  const [displaySets, setDisplaySets] = useState([]);\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\n  const [jumpToDisplaySet, setJumpToDisplaySet] = useState(null);\n\n  const onDoubleClickThumbnailHandler = (displaySetInstanceUID) => {\n    viewportGridService.setDisplaySetsForViewport({\n      viewportId: activeViewportId,\n      displaySetInstanceUIDs: [displaySetInstanceUID],\n    });\n  };\n\n  const activeViewportDisplaySetInstanceUIDs =\n    viewports.get(activeViewportId)?.displaySetInstanceUIDs;\n\n  const isSingleViewport = numCols === 1 && numRows === 1;\n\n  useEffect(() => {\n    const added = MeasurementService.EVENTS.MEASUREMENT_ADDED;\n    const addedRaw = MeasurementService.EVENTS.RAW_MEASUREMENT_ADDED;\n    const subscriptions = [];\n\n    [added, addedRaw].forEach((evt) => {\n      subscriptions.push(\n        MeasurementService.subscribe(evt, ({ source, measurement }) => {\n          const {\n            referenceSeriesUID: SeriesInstanceUID,\n            referenceStudyUID: StudyInstanceUID,\n          } = measurement;\n        }).unsubscribe\n      );\n    });\n\n    return () => {\n      subscriptions.forEach((unsub) => {\n        unsub();\n      });\n    };\n  }, [MeasurementService, activeViewportId]);\n\n  // ~~ studyDisplayList\n  useEffect(() => {\n    // Fetch all studies for the patient in each primary study\n    async function fetchStudiesForPatient(StudyInstanceUID) {\n      // current study qido\n      const qidoForStudyUID = await dataSource.query.studies.search({\n        studyInstanceUid: StudyInstanceUID,\n      });\n\n      if (!qidoForStudyUID?.length) {\n        navigate('/notfoundstudy', '_self');\n        throw new Error('Invalid study URL');\n      }\n\n      let qidoStudiesForPatient = qidoForStudyUID;\n\n      // try to fetch the prior studies based on the patientID if the\n      // server can respond.\n      try {\n        qidoStudiesForPatient = await getStudiesForPatientByMRN(qidoForStudyUID);\n      } catch (error) {\n        console.warn(error);\n      }\n\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\n        return {\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\n          date: formatDate(qidoStudy.StudyDate),\n          description: qidoStudy.StudyDescription,\n          modalities: qidoStudy.ModalitiesInStudy,\n          numInstances: qidoStudy.NumInstances,\n        };\n      });\n\n      setStudyDisplayList(prevArray => {\n        const ret = [...prevArray];\n        for (const study of actuallyMappedStudies) {\n          if (!prevArray.find(it => it.studyInstanceUid === study.studyInstanceUid)) {\n            ret.push(study);\n          }\n        }\n        return ret;\n      });\n    }\n\n    StudyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\n  }, [StudyInstanceUIDs, dataSource, getStudiesForPatientByMRN, navigate]);\n\n  // ~~ Initial Thumbnails\n  useEffect(() => {\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\n    currentDisplaySets.forEach(async dSet => {\n      const newImageSrcEntry = {};\n      const displaySet = DisplaySetService.getDisplaySetByUID(\n        dSet.displaySetInstanceUID\n      );\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n      const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n      // TODO: Is it okay that imageIds are not returned here for SR displaysets?\n      if (imageId) {\n        // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n        newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\n          imageId\n        );\n        setThumbnailImageSrcMap(prevState => {\n          return { ...prevState, ...newImageSrcEntry };\n        });\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [DisplaySetService, dataSource, getImageSrc]);\n\n  // ~~ displaySets\n  useEffect(() => {\n    // TODO: Are we sure `activeDisplaySets` will always be accurate?\n    const currentDisplaySets = DisplaySetService.activeDisplaySets;\n    const mappedDisplaySets = _mapDisplaySets(\n      currentDisplaySets,\n      thumbnailImageSrcMap,\n      viewports,\n      isSingleViewport,\n      dataSource,\n      DisplaySetService,\n      UIDialogService,\n      UINotificationService\n    );\n\n    setDisplaySets(mappedDisplaySets);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    DisplaySetService.activeDisplaySets,\n    thumbnailImageSrcMap,\n    viewports,\n    dataSource,\n  ]);\n\n  // ~~ subscriptions --> displaySets\n  useEffect(() => {\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\n    const SubscriptionDisplaySetsAdded = DisplaySetService.subscribe(\n      DisplaySetService.EVENTS.DISPLAY_SETS_ADDED,\n      data => {\n        const { displaySetsAdded, options } = data;\n        displaySetsAdded.forEach(async dSet => {\n          const displaySetInstanceUID = dSet.displaySetInstanceUID;\n\n          const newImageSrcEntry = {};\n          const displaySet = DisplaySetService.getDisplaySetByUID(\n            displaySetInstanceUID\n          );\n\n          if (options.madeInClient) {\n            setJumpToDisplaySet(displaySetInstanceUID);\n          }\n\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n          const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\n          if (imageId) {\n            // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n            newImageSrcEntry[displaySetInstanceUID] = await getImageSrc(\n              imageId\n            );\n            setThumbnailImageSrcMap(prevState => {\n              return { ...prevState, ...newImageSrcEntry };\n            });\n          }\n        });\n      }\n    );\n\n    // TODO: Will this always hold _all_ the displaySets we care about?\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\n    const SubscriptionDisplaySetsChanged = DisplaySetService.subscribe(\n      DisplaySetService.EVENTS.DISPLAY_SETS_CHANGED,\n      changedDisplaySets => {\n        const mappedDisplaySets = _mapDisplaySets(\n          changedDisplaySets,\n          thumbnailImageSrcMap,\n          viewports,\n          isSingleViewport,\n          dataSource,\n          DisplaySetService,\n          UIDialogService,\n          UINotificationService\n        );\n\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsAdded.unsubscribe();\n      SubscriptionDisplaySetsChanged.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [\n    DisplaySetService,\n    dataSource,\n    getImageSrc,\n    thumbnailImageSrcMap,\n    viewports,\n  ]);\n\n  const tabs = _createStudyBrowserTabs(\n    StudyInstanceUIDs,\n    studyDisplayList,\n    displaySets\n  );\n\n  // TODO: Should not fire this on \"close\"\n  function _handleStudyClick(StudyInstanceUID) {\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(\n      StudyInstanceUID\n    );\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\n      ? [\n          ...expandedStudyInstanceUIDs.filter(\n            stdyUid => stdyUid !== StudyInstanceUID\n          ),\n        ]\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\n\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n\n    if (!shouldCollapseStudy) {\n      const madeInClient = true;\n      requestDisplaySetCreationForStudy(\n        DisplaySetService,\n        StudyInstanceUID,\n        madeInClient\n      );\n    }\n  }\n\n  useEffect(() => {\n    if (jumpToDisplaySet) {\n      // Get element by displaySetInstanceUID\n      const displaySetInstanceUID = jumpToDisplaySet;\n      const element = document.getElementById(\n        `thumbnail-${displaySetInstanceUID}`\n      );\n\n      if (element && typeof element.scrollIntoView === 'function') {\n        // TODO: Any way to support IE here?\n        element.scrollIntoView({ behavior: 'smooth' });\n\n        setJumpToDisplaySet(null);\n      }\n    }\n  }, [jumpToDisplaySet, expandedStudyInstanceUIDs, activeTabName]);\n\n  useEffect(() => {\n    if (!jumpToDisplaySet) {\n      return;\n    }\n\n    const displaySetInstanceUID = jumpToDisplaySet;\n    // Set the activeTabName and expand the study\n    const thumbnailLocation = _findTabAndStudyOfDisplaySet(\n      displaySetInstanceUID,\n      tabs\n    );\n    if (!thumbnailLocation) {\n      console.warn('jumpToThumbnail: displaySet thumbnail not found.');\n\n      return;\n    }\n    const { tabName, StudyInstanceUID } = thumbnailLocation;\n    setActiveTabName(tabName);\n    const studyExpanded = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\n    if (!studyExpanded) {\n      const updatedExpandedStudyInstanceUIDs = [\n        ...expandedStudyInstanceUIDs,\n        StudyInstanceUID,\n      ];\n      setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n    }\n  }, [expandedStudyInstanceUIDs, jumpToDisplaySet, tabs]);\n\n  return (\n    <StudyBrowser\n      tabs={tabs}\n      activeTabName={activeTabName}\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\n      onClickStudy={_handleStudyClick}\n      onClickTab={clickedTabName => {\n        setActiveTabName(clickedTabName);\n      }}\n      onClickThumbnail={() => {}}\n      onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\n      activeDisplaySetInstanceUIDs={activeViewportDisplaySetInstanceUIDs}\n    />\n  );\n}\n\nPanelStudyBrowserTracking.propTypes = {\n  MeasurementService: PropTypes.shape({\n    subscribe: PropTypes.func.isRequired,\n    EVENTS: PropTypes.object.isRequired,\n  }).isRequired,\n  DisplaySetService: PropTypes.shape({\n    EVENTS: PropTypes.object.isRequired,\n    activeDisplaySets: PropTypes.arrayOf(PropTypes.object).isRequired,\n    getDisplaySetByUID: PropTypes.func.isRequired,\n    subscribe: PropTypes.func.isRequired,\n  }).isRequired,\n  dataSource: PropTypes.shape({\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\n  }).isRequired,\n  getImageSrc: PropTypes.func.isRequired,\n  getStudiesForPatientByMRN: PropTypes.func.isRequired,\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\n};\n\nexport default PanelStudyBrowserTracking;\n\n/**\n * Maps from the DataSource's format to a naturalized object\n *\n * @param {*} studies\n */\nfunction _mapDataSourceStudies(studies) {\n  return studies.map(study => {\n    // TODO: Why does the data source return in this format?\n    return {\n      AccessionNumber: study.accession,\n      StudyDate: study.date,\n      StudyDescription: study.description,\n      NumInstances: study.instances,\n      ModalitiesInStudy: study.modalities,\n      PatientID: study.mrn,\n      PatientName: study.patientName,\n      StudyInstanceUID: study.studyInstanceUid,\n      StudyTime: study.time,\n    };\n  });\n}\n\nfunction _mapDisplaySets(\n  displaySets,\n  thumbnailImageSrcMap,\n  viewports, // TODO: make array of `displaySetInstanceUIDs`?\n  isSingleViewport,\n  dataSource,\n  DisplaySetService,\n  UIDialogService,\n  UINotificationService\n) {\n  const thumbnailDisplaySets = [];\n  const thumbnailNoImageDisplaySets = [];\n  displaySets.forEach(ds => {\n    const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\n    const componentType = _getComponentType(ds.Modality);\n    const viewportIdentificator = isSingleViewport\n      ? []\n      : Object.values(viewports).reduce((acc, viewportData, index) => {\n          if (\n            viewportData?.displaySetInstanceUIDs?.includes(\n              ds.displaySetInstanceUID\n            )\n          ) {\n            acc.push(viewportData.viewportLabel);\n          }\n          return acc;\n        }, []);\n\n    const array =\n      componentType === 'thumbnailTracked'\n        ? thumbnailDisplaySets\n        : thumbnailNoImageDisplaySets;\n\n    const { displaySetInstanceUID } = ds;\n\n    const thumbnailProps = {\n      displaySetInstanceUID,\n      description: ds.SeriesDescription,\n      seriesNumber: String(ds.SeriesNumber),\n      modality: ds.Modality,\n      seriesDate: formatDate(ds.SeriesDate),\n      numInstances: ds.numImageFrames,\n      StudyInstanceUID: ds.StudyInstanceUID,\n      componentType,\n      imageSrc,\n      dragData: {\n        type: 'displayset',\n        displaySetInstanceUID,\n        // .. Any other data to pass\n      },\n      viewportIdentificator,\n    };\n\n    if (componentType === 'thumbnailNoImage') {\n      if (dataSource.reject && dataSource.reject.series) {\n        thumbnailProps.canReject = true;\n        thumbnailProps.onReject = () => {\n          UIDialogService.create({\n            id: 'ds-reject-sr',\n            centralize: true,\n            isDraggable: false,\n            showOverlay: true,\n            content: Dialog,\n            contentProps: {\n              title: 'Delete Report',\n              body: () => (\n                <div className=\"p-4 text-white bg-primary-dark\">\n                  <p>Are you sure you want to delete this report?</p>\n                  <p>This action cannot be undone.</p>\n                </div>\n              ),\n              actions: [\n                { id: 'cancel', text: 'Cancel', type: 'secondary' },\n                {\n                  id: 'yes',\n                  text: 'Yes',\n                  type: 'primary',\n                  classes: ['reject-yes-button'],\n                },\n              ],\n              onClose: () => UIDialogService.dismiss({ id: 'ds-reject-sr' }),\n              onShow: () => {\n                const yesButton = document.querySelector('.reject-yes-button');\n\n                yesButton.focus();\n              },\n              onSubmit: async ({ action }) => {\n                switch (action.id) {\n                  case 'yes':\n                    try {\n                      await dataSource.reject.series(\n                        ds.StudyInstanceUID,\n                        ds.SeriesInstanceUID\n                      );\n                      DisplaySetService.deleteDisplaySet(displaySetInstanceUID);\n                      UIDialogService.dismiss({ id: 'ds-reject-sr' });\n                      UINotificationService.show({\n                        title: 'Delete Report',\n                        message: 'Report deleted successfully',\n                        type: 'success',\n                      });\n                    } catch (error) {\n                      UIDialogService.dismiss({ id: 'ds-reject-sr' });\n                      UINotificationService.show({\n                        title: 'Delete Report',\n                        message: 'Failed to delete report',\n                        type: 'error',\n                      });\n                    }\n                    break;\n                  case 'cancel':\n                    UIDialogService.dismiss({ id: 'ds-reject-sr' });\n                    break;\n                }\n              },\n            },\n          });\n        };\n      } else {\n        thumbnailProps.canReject = false;\n      }\n    }\n\n    array.push(thumbnailProps);\n  });\n\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\n}\n\nconst thumbnailNoImageModalities = [\n  'SR',\n  'SEG',\n  'RTSTRUCT',\n  'RTPLAN',\n  'RTDOSE',\n];\n\nfunction _getComponentType(Modality) {\n  if (thumbnailNoImageModalities.includes(Modality)) {\n    return 'thumbnailNoImage';\n  }\n\n  return 'thumbnailTracked';\n}\n\nconst _viewportLabels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I'];\n\n/**\n *\n * @param {string[]} primaryStudyInstanceUIDs\n * @param {object[]} studyDisplayList\n * @param {string} studyDisplayList.studyInstanceUid\n * @param {string} studyDisplayList.date\n * @param {string} studyDisplayList.description\n * @param {string} studyDisplayList.modalities\n * @param {number} studyDisplayList.numInstances\n * @param {object[]} displaySets\n * @returns tabs - The prop object expected by the StudyBrowser component\n */\nfunction _createStudyBrowserTabs(\n  primaryStudyInstanceUIDs,\n  studyDisplayList,\n  displaySets\n) {\n  const primaryStudies = [];\n  const recentStudies = [];\n  const allStudies = [];\n\n  // Iterate over each study...\n  studyDisplayList.forEach(study => {\n    // Find it's display sets\n    const displaySetsForStudy = displaySets.filter(\n      ds => ds.StudyInstanceUID === study.studyInstanceUid\n    );\n\n    // Sort them\n    const sortedDisplaySetsForStudy = utils.sortBySeriesDate(\n      displaySetsForStudy\n    );\n\n    /* Sort by series number, then by series date\n      displaySetsForStudy.sort((a, b) => {\n        if (a.seriesNumber !== b.seriesNumber) {\n          return a.seriesNumber - b.seriesNumber;\n        }\n\n        const seriesDateA = Date.parse(a.seriesDate);\n        const seriesDateB = Date.parse(b.seriesDate);\n\n        return seriesDateA - seriesDateB;\n      });\n    */\n\n    // Map the study to it's tab/view representation\n    const tabStudy = Object.assign({}, study, {\n      displaySets: displaySetsForStudy,\n    });\n\n    // Add the \"tab study\" to the 'primary', 'recent', and/or 'all' tab group(s)\n    if (primaryStudyInstanceUIDs.includes(study.studyInstanceUid)) {\n      primaryStudies.push(tabStudy);\n      allStudies.push(tabStudy);\n    } else {\n      // TODO: Filter allStudies to dates within one year of current date\n      recentStudies.push(tabStudy);\n      allStudies.push(tabStudy);\n    }\n  });\n\n  // Newest first\n  const _byDate = (a, b) => {\n    const dateA = Date.parse(a);\n    const dateB = Date.parse(b);\n\n    return dateB - dateA;\n  };\n\n  const tabs = [\n    {\n      name: 'primary',\n      label: 'Primary',\n      studies: primaryStudies.sort((studyA, studyB) =>\n        _byDate(studyA.date, studyB.date)\n      ),\n    },\n    {\n      name: 'recent',\n      label: 'Recent',\n      studies: recentStudies.sort((studyA, studyB) =>\n        _byDate(studyA.date, studyB.date)\n      ),\n    },\n    {\n      name: 'all',\n      label: 'All',\n      studies: allStudies.sort((studyA, studyB) =>\n        _byDate(studyA.date, studyB.date)\n      ),\n    },\n  ];\n\n  return tabs;\n}\n\nfunction _findTabAndStudyOfDisplaySet(displaySetInstanceUID, tabs) {\n  for (let t = 0; t < tabs.length; t++) {\n    const { studies } = tabs[t];\n\n    for (let s = 0; s < studies.length; s++) {\n      const { displaySets } = studies[s];\n\n      for (let d = 0; d < displaySets.length; d++) {\n        const displaySet = displaySets[d];\n\n        if (displaySet.displaySetInstanceUID === displaySetInstanceUID) {\n          return {\n            tabName: tabs[t].name,\n            StudyInstanceUID: studies[s].studyInstanceUid,\n          };\n        }\n      }\n    }\n  }\n}\n","function getImageSrcFromImageId(cornerstone, imageId: string) {\n  return new Promise((resolve, reject) => {\n    const canvas = document.createElement('canvas');\n    cornerstone.utilities\n      .loadImageToCanvas({ canvas, imageId })\n      .then(() => {\n        resolve(canvas.toDataURL());\n      })\n      .catch(reject);\n  });\n}\n\nexport default getImageSrcFromImageId;\n","function requestDisplaySetCreationForStudy(\n  dataSource,\n  DisplaySetService,\n  StudyInstanceUID: string,\n  madeInClient: boolean\n) {\n  if (\n    DisplaySetService.activeDisplaySets.some(\n      (displaySet) => displaySet.StudyInstanceUID === StudyInstanceUID\n    )\n  ) {\n    return;\n  }\n\n  dataSource.retrieve.series.metadata({ StudyInstanceUID, madeInClient });\n}\n\nexport default requestDisplaySetCreationForStudy;\n","import getImageSrcFromImageId from './getImageSrcFromImageId';\nimport requestDisplaySetCreationForStudy from './requestDisplaySetCreationForStudy';\n\nexport function createGetImageSrcFromImageIdFn(extensionManager) {\n  const utilities = extensionManager.getModuleEntry(\n    '@ohif/extension-cornerstone.utilityModule.common'\n  );\n\n  try {\n    const { cornerstone } = utilities.exports.getCornerstoneLibraries();\n    return getImageSrcFromImageId.bind(null, cornerstone);\n  } catch (ex) {\n    throw new Error('Required command not found');\n  }\n}\n\nexport function getStudyForPatientUtility(extensionManager, datasource) {\n  const utilityModule = extensionManager.getModuleEntry(\n    '@ohif/extension-default.utilityModule.common'\n  );\n\n  const { getStudiesForPatientByMRN } = utilityModule.exports;\n  return getStudiesForPatientByMRN.bind(null, datasource);\n}\n\nexport function createRequestDisplaySetcreationFn(datasource) {\n  return requestDisplaySetCreationForStudy.bind(null, datasource);\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport PanelStudyBrowserTracking from './PanelStudyBrowserTracking';\nimport { studyPanelUtilities } from '../utils';\n\nconst {\n  createGetImageSrcFromImageIdFn,\n  createRequestDisplaySetcreationFn,\n  getStudyForPatientUtility,\n} = studyPanelUtilities;\n\n/**\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\n *\n * @param {object} params\n * @param {object} commandsManager\n * @param {object} extensionManager\n */\nfunction WrappedPanelStudyBrowserTracking({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}) {\n  const dataSource = extensionManager.getActiveDataSource()[0];\n\n  const _getStudiesForPatientByMRN = getStudyForPatientUtility(\n    extensionManager,\n    dataSource\n  );\n  const _getImageSrcFromImageId =\n    createGetImageSrcFromImageIdFn(extensionManager);\n  const _requestDisplaySetCreationForStudy =\n    createRequestDisplaySetcreationFn(dataSource);\n\n  return (\n    <PanelStudyBrowserTracking\n      MeasurementService={servicesManager.services.MeasurementService}\n      DisplaySetService={servicesManager.services.DisplaySetService}\n      UIDialogService={servicesManager.services.UIDialogService}\n      UINotificationService={servicesManager.services.UINotificationService}\n      dataSource={dataSource}\n      getImageSrc={_getImageSrcFromImageId}\n      getStudiesForPatientByMRN={_getStudiesForPatientByMRN}\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\n    />\n  );\n}\n\nWrappedPanelStudyBrowserTracking.propTypes = {\n  commandsManager: PropTypes.object.isRequired,\n  extensionManager: PropTypes.object.isRequired,\n  servicesManager: PropTypes.object.isRequired,\n};\n\nexport default WrappedPanelStudyBrowserTracking;\n","import React, { useEffect, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  StudySummary,\n  MeasurementTable,\n  Dialog,\n  Input,\n  useViewportGrid,\n} from '@ohif/ui';\nimport { DicomMetadataStore, utils } from '@ohif/core';\n\nfunction useDebounce(value, delay) {\n  // State and setters for debounced value\n  const [debouncedValue, setDebouncedValue] = useState(value);\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value);\n      }, delay);\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler);\n      };\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  );\n  return debouncedValue;\n}\n\nconst { downloadCSVReport } = utils;\nconst { formatDate } = utils;\n\nconst DISPLAY_STUDY_SUMMARY_INITIAL_VALUE = {\n  key: undefined, //\n  date: undefined, // '07-Sep-2010',\n  modality: undefined, // 'CT',\n  description: undefined, // 'CHEST/ABD/PELVIS W CONTRAST',\n};\n\nfunction PanelMeasurementTableTracking({ servicesManager, extensionManager }) {\n  const [viewportGrid, viewportGridService] = useViewportGrid();\n  const [measurementChangeTimestamp, setMeasurementsUpdated] = useState(\n    Date.now().toString()\n  );\n  const debouncedMeasurementChangeTimestamp = useDebounce(\n    measurementChangeTimestamp,\n    200\n  );\n  const {\n    MeasurementService,\n    UIDialogService,\n    DisplaySetService,\n  } = servicesManager.services;\n\n  const [displayStudySummary, setDisplayStudySummary] = useState(\n    DISPLAY_STUDY_SUMMARY_INITIAL_VALUE\n  );\n  const [displayMeasurements, setDisplayMeasurements] = useState([]);\n\n  useEffect(() => {\n    const measurements = MeasurementService.getMeasurements();\n\n    const mappedMeasurements = measurements.map(m =>\n      _mapMeasurementToDisplay(\n        m,\n        MeasurementService.VALUE_TYPES,\n        DisplaySetService\n      )\n    );\n    setDisplayMeasurements(mappedMeasurements);\n    // eslint-ignore-next-line\n  }, [\n    MeasurementService,\n    debouncedMeasurementChangeTimestamp,\n  ]);\n\n\n  // ~~ DisplayStudySummary\n  useEffect(() => {\n    setDisplayStudySummary(DISPLAY_STUDY_SUMMARY_INITIAL_VALUE);\n  }, [\n    displayStudySummary.key,\n  ]);\n\n  // TODO: Better way to consolidated, debounce, check on change?\n  // Are we exposing the right API for measurementService?\n  // This watches for ALL MeasurementService changes. It updates a timestamp,\n  // which is debounced. After a brief period of inactivity, this triggers\n  // a re-render where we grab up-to-date measurements\n  useEffect(() => {\n    const added = MeasurementService.EVENTS.MEASUREMENT_ADDED;\n    const addedRaw = MeasurementService.EVENTS.RAW_MEASUREMENT_ADDED;\n    const updated = MeasurementService.EVENTS.MEASUREMENT_UPDATED;\n    const removed = MeasurementService.EVENTS.MEASUREMENT_REMOVED;\n    const cleared = MeasurementService.EVENTS.MEASUREMENTS_CLEARED;\n    const subscriptions = [];\n\n    [added, addedRaw, updated, removed, cleared].forEach(evt => {\n      subscriptions.push(\n        MeasurementService.subscribe(evt, () => {\n          setMeasurementsUpdated(Date.now().toString());\n        }).unsubscribe\n      );\n    });\n\n    return () => {\n      subscriptions.forEach(unsub => {\n        unsub();\n      });\n    };\n  }, [MeasurementService]);\n\n  async function exportReport() {\n    const measurements = MeasurementService.getMeasurements();\n    downloadCSVReport(measurements, MeasurementService);\n  }\n\n  const jumpToImage = ({ uid, isActive }) => {\n    MeasurementService.jumpToMeasurement(viewportGrid.activeViewportId, uid);\n\n    onMeasurementItemClickHandler({ uid, isActive });\n  };\n\n  const onMeasurementItemEditHandler = ({ uid, isActive }) => {\n    const measurement = MeasurementService.getMeasurement(uid);\n    jumpToImage({ uid, isActive });\n\n    const onSubmitHandler = ({ action, value }) => {\n      switch (action.id) {\n        case 'save': {\n          MeasurementService.update(\n            uid,\n            {\n              ...measurement,\n              ...value,\n            },\n            true\n          );\n        }\n      }\n      UIDialogService.dismiss({ id: 'enter-annotation' });\n    };\n\n    UIDialogService.create({\n      id: 'enter-annotation',\n      centralize: true,\n      isDraggable: false,\n      showOverlay: true,\n      content: Dialog,\n      contentProps: {\n        title: 'Enter your annotation',\n        noCloseButton: true,\n        value: { label: measurement.label || '' },\n        body: ({ value, setValue }) => {\n          const onChangeHandler = event => {\n            event.persist();\n            setValue(value => ({ ...value, label: event.target.value }));\n          };\n\n          const onKeyPressHandler = event => {\n            if (event.key === 'Enter') {\n              onSubmitHandler({ value, action: { id: 'save' } });\n            }\n          };\n          return (\n            <div className=\"p-4 bg-primary-dark\">\n              <Input\n                autoFocus\n                className=\"mt-2 bg-black border-primary-main\"\n                type=\"text\"\n                containerClassName=\"mr-2\"\n                value={value.label}\n                onChange={onChangeHandler}\n                onKeyPress={onKeyPressHandler}\n              />\n            </div>\n          );\n        },\n        actions: [\n          // temp: swap button types until colors are updated\n          { id: 'cancel', text: 'Cancel', type: 'primary' },\n          { id: 'save', text: 'Save', type: 'secondary' },\n        ],\n        onSubmit: onSubmitHandler,\n      },\n    });\n  };\n\n  const onMeasurementItemClickHandler = ({ uid, isActive }) => {\n    if (!isActive) {\n      const measurements = [...displayMeasurements];\n      const measurement = measurements.find(m => m.uid === uid);\n\n      measurements.forEach(m => (m.isActive = m.uid !== uid ? false : true));\n      measurement.isActive = true;\n      setDisplayMeasurements(measurements);\n    }\n  };\n\n  const onMeasurementDeleteHandler = ({ uid }) => {\n    MeasurementService.remove(uid)\n  }\n\n  const displayMeasurementsWithoutFindings = displayMeasurements.filter(\n    dm => dm.measurementType !== MeasurementService.VALUE_TYPES.POINT\n  );\n  const additionalFindings = displayMeasurements.filter(\n    dm => dm.measurementType === MeasurementService.VALUE_TYPES.POINT\n  );\n\n  return (\n    <>\n      <div\n        className=\"overflow-x-hidden overflow-y-auto invisible-scrollbar\"\n        data-cy={'trackedMeasurements-panel'}\n      >\n        {displayStudySummary.key && (\n          <StudySummary\n            date={formatDate(displayStudySummary.date)}\n            modality={displayStudySummary.modality}\n            description={displayStudySummary.description}\n          />\n        )}\n        <MeasurementTable\n          title=\"Measurements\"\n          amount={displayMeasurementsWithoutFindings.length}\n          data={displayMeasurementsWithoutFindings}\n          onClick={jumpToImage}\n          onEdit={onMeasurementItemEditHandler}\n          onDelete={onMeasurementDeleteHandler}\n        />\n        {additionalFindings.length !== 0 && (\n          <MeasurementTable\n            title=\"Additional Findings\"\n            amount={additionalFindings.length}\n            data={additionalFindings}\n            onClick={jumpToImage}\n            onDelete={onMeasurementDeleteHandler}\n            />\n        )}\n      </div>\n    </>\n  );\n}\n\nPanelMeasurementTableTracking.propTypes = {\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n      MeasurementService: PropTypes.shape({\n        getMeasurements: PropTypes.func.isRequired,\n        VALUE_TYPES: PropTypes.object.isRequired,\n      }).isRequired,\n    }).isRequired,\n  }).isRequired,\n};\n\n// TODO: This could be a MeasurementService mapper\nfunction _mapMeasurementToDisplay(measurement, types, DisplaySetService) {\n  const { referenceStudyUID, referenceSeriesUID, SOPInstanceUID } = measurement;\n\n  // TODO: We don't deal with multiframe well yet, would need to update\n  // This in OHIF-312 when we add FrameIndex to measurements.\n\n  const instance = DicomMetadataStore.getInstance(\n    referenceStudyUID,\n    referenceSeriesUID,\n    SOPInstanceUID\n  );\n\n  const displaySets = DisplaySetService.getDisplaySetsForSeries(\n    referenceSeriesUID\n  );\n\n  if (!displaySets[0] || !displaySets[0].images) {\n    throw new Error(\n      'The tracked measurements panel should only be tracking \"stack\" displaySets.'\n    );\n  }\n\n  const { displayText } = measurement;\n  return {\n    uid: measurement.uid,\n    label: measurement.label || '(empty)',\n    measurementType: measurement.type,\n    displayText: displayText || [],\n    isActive: false, // activeMeasurementItem === i + 1,\n  };\n}\n\nexport default PanelMeasurementTableTracking;\n","import * as React from 'react';\nimport Rating from '@mui/material/Rating';\nimport Paper from '@mui/material/Paper';\nimport StarIcon from '@mui/icons-material/Star';\nimport Typography from '@mui/material/Typography';\n\nexport default function RatingSelector({ formIndex, name, value, defaultValue, options, onChange }) {\n  const { labels, precision, max } = options\n\n  const getKeyFromValue = (v)=>{\n    if(v == null) return null\n\n    const obj = Object.keys(labels).map((key, idx)=>{\n      return {key: key, value: labels[key].value}\n    }).find((ele)=>{\n      return ele.value == v\n    })\n\n    if(obj) return Number(obj.key)\n    return null\n  }\n\n  const [val, setVal] = React.useState(value !== null ? getKeyFromValue(value): getKeyFromValue(defaultValue));  \n  const [hover, setHover] = React.useState(-1);\n\n  return (\n    <Paper className='p-2'>\n      <div>\n        <Typography sx={{ fontSize: 14 }} color=\"text.secondary\" gutterBottom>\n          { name }\n        </Typography>\n        <Typography variant=\"h6\" component=\"div\">\n          { (val !== null || hover !== -1) ? labels[hover !== -1 ? hover : val].value : '?' }\n        </Typography>\n        <Typography variant=\"body2\">\n          { (val !== null || hover !== -1) ? labels[hover !== -1 ? hover : val].description : 'Please Select'}\n        </Typography>\n      </div>\n      <Rating\n        name=\"hover-feedback\"\n        value={val}\n        precision={precision}\n        max={max}\n        onChange={(event, newValue) => {\n          onChange({ formIndex: formIndex, value: newValue ? labels[newValue].value : newValue })\n          setVal(newValue);\n        }}\n        onChangeActive={(event, newHover) => {\n          setHover(newHover);\n        }}\n        emptyIcon={<StarIcon style={{ opacity: 0.55 }} fontSize=\"inherit\" />}\n      />\n    </Paper>\n  );\n}\n","import * as React from 'react';\nimport Paper from '@mui/material/Paper';\nimport Typography from '@mui/material/Typography';\nimport RadioGroup from '@mui/material/RadioGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport Radio from '@mui/material/Radio';\n\nexport default function GridSelector({ formIndex, name, value, defaultValue, options, onChange }) {\n  const { labels, cols } = options\n  const [val, setVal] = React.useState(value !== null ? value : defaultValue);  \n  React.useEffect(()=>{\n    setVal(value !== null ? value : defaultValue)\n  }, [value])\n\n  return (\n    <Paper className='p-2'>\n      <div>\n        <Typography sx={{ fontSize: 14 }} color=\"text.secondary\" gutterBottom>\n          { name }\n        </Typography>\n        <Typography variant=\"body2\" component=\"div\">\n          { Boolean(labels.find(ele=>(ele.value==val)))  ? labels.find(ele=>(ele.value==val)).description : '?' }\n        </Typography>\n      </div>\n      { \n        labels.reduce((all,one,i) => {\n           const ch = Math.floor(i/(cols || 3)); \n           all[ch] = [].concat((all[ch]||[]),one); \n           return all\n        }, []).map((chunk, idx) => {\n          return <RadioGroup\n            row\n            key={idx}\n            name=\"grid-select-row\"\n            value={val}\n            onChange={(event, newValue) => {\n              onChange({ formIndex: formIndex, value: newValue})\n              setVal(newValue);\n            }}\n          >\n            {\n              chunk.map((label, idx) => {\n                return <FormControlLabel key={idx} value={label.value} control={<Radio />} label={label.value} />\n              })\n            }\n          </RadioGroup>\n        })\n      }\n    </Paper>\n  );\n}","import * as React from 'react';\nimport FormGroup from '@mui/material/FormGroup';\nimport FormControlLabel from '@mui/material/FormControlLabel';\nimport Checkbox from '@mui/material/Checkbox';\nimport Paper from '@mui/material/Paper';\nimport Typography from '@mui/material/Typography';\n\nexport default function CheckboxLabels({formIndex, name, value, defaultValue, options, onChange}) {\n  \n  let checked\n  if(value !== null){\n    checked = Boolean(value)\n  } else {\n    checked = Boolean(defaultValue)\n    onChange({ formIndex: formIndex, value: checked })\n  }\n\n  return (\n    <Paper className='p-2'>\n        <FormGroup>\n            <FormControlLabel \n              control={\n                <Checkbox \n                    checked = { checked }\n                    onChange={ (evt)=> onChange({ formIndex: formIndex, value: evt.target.checked }) }\n                />\n              } \n              label={\n                <Typography variant=\"body2\" color=\"textSecondary\">{name}</Typography>\n              }/>\n        </FormGroup>\n    </Paper>\n  );\n}","import React, { useState, useMemo, useEffect } from 'react';\nimport Paper from '@mui/material/Paper';\nimport TextField from '@mui/material/TextField';\nimport debounce from 'lodash.debounce';\n\nexport default function Textarea({formIndex, name, value, defaultValue, options, onChange}) {\n  const [val, setVal] = useState(value ?? defaultValue ?? '');\n  const { rows } = options\n  const debouncedOnChange = useMemo(\n    () => debounce((formIndex, value) => {\n        onChange({formIndex, value})\n      }, 600), [onChange]\n  );\n\n  useEffect(() => {\n    setVal(value ?? defaultValue ?? '');\n  }, [value, defaultValue]);\n\n  const handleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setVal(event.target.value);\n    debouncedOnChange(formIndex, event.target.value)\n  };\n\n  return (\n    <Paper className='p-2'>\n      <TextField\n        id=\"outlined-multiline-flexible\"\n        inputProps={{style: {fontSize: '0.75em'}}}\n        label={name}\n        multiline\n        rows={ rows }\n        value={val}\n        fullWidth={true}\n        margin={'dense'}\n        size={'small'}\n        onChange={handleChange}\n      />\n    </Paper>\n  );\n}","import * as React from 'react';\nimport Paper from '@mui/material/Paper';\nimport Typography from '@mui/material/Typography';\n\nexport default function DisplayValue({formIndex, name, value, defaultValue, options}) {\n  return (\n    <Paper sx={{ display: 'flex' }} className='p-2'>\n        <Typography sx={{ fontSize: 14, marginRight: 1 }} color=\"text.secondary\" gutterBottom>\n          { name }:\n        </Typography>\n        <Typography variant=\"body2\" className=\"overflow-auto invisible-scrollbar\">\n          { value !== null ? value.toString() : defaultValue !== null ? defaultValue.toString() : '' } \n        </Typography>\n    </Paper>\n  );\n}","import * as React from 'react';\nimport Paper from '@mui/material/Paper';\nimport CardHeader from '@mui/material/CardHeader';\nimport Avatar from '@mui/material/Avatar';\n\nfunction dhm(t) {\n    var cd = 24 * 60 * 60 * 1000,\n        ch = 60 * 60 * 1000,\n        d = Math.floor(t / cd),\n        h = Math.floor( (t - d * cd) / ch),\n        m = Math.round( (t - d * cd - h * ch) / 60000)\n  if( m === 60 ){\n    h++;\n    m = 0;\n  }\n  if( h === 24 ){\n    d++;\n    h = 0;\n  }\n  return [d, h, m]\n}\n\nexport default function UserProfile({value}) {\n    const getDateText = (lastUpdated) => {\n        const [days, hours, minutes] = dhm(Date.now() - lastUpdated)\n\n        if(days > 7){\n            return (new Date(lastUpdated)).toLocaleDateString('en-us', { year:\"numeric\", month:\"short\", day:\"numeric\"})\n        }\n        if(days > 2){\n            return `${days} days ago`\n        }\n        if(hours > 2){\n            return `${hours} hours ago`\n        }\n        if(minutes > 2){\n            return `${minutes} mins ago`\n        }\n        return `just now`\n    }\n\n    try{\n        value = JSON.parse(value)\n    } catch (e){\n        console.error(e, value)\n        value = null\n    }\n    \n    if(value){\n        return (\n            <Paper>\n                <CardHeader\n                    sx={{\n                        \"& .MuiCardHeader-content\": {\n                            overflow: \"hidden\"\n                        }\n                    }}\n                    avatar={\n                        <Avatar \n                            imgProps={{\n                                crossOrigin: \"anonymous\",\n                                referrerPolicy: \"no-referrer\"\n                            }}\n                            src={ value.picture }/>\n                    }\n                    title={ value.email }\n                    subheader={ `Updated ${getDateText(value.lastUpdated)}` }\n                />\n            </Paper>\n        );\n    }\n    return (\n        <Paper>\n            <CardHeader\n                sx={{\n                    \"& .MuiCardHeader-content\": {\n                        overflow: \"hidden\"\n                    }\n                }}\n                avatar={\n                    <Avatar/>\n                }\n                title={ '----' }\n                subheader={ `No last update` }\n            />\n        </Paper>\n    )\n}","import React from 'react';\nimport RatingSelector from './fields/RatingSelector'\nimport GridSelector from './fields/GridSelector'\nimport Checkbox from './fields/Checkbox'\nimport Textarea from './fields/Textarea'\nimport DisplayValue from './fields/DisplayValue'\nimport UserProfile from './fields/UserProfile'\n\nfunction FormGeneratorComponent({ formTemplate, formValue, setFormValue }) {\n  const onChangeHandler = ({formIndex, value}) => {\n    const newFormValue = [...formValue]\n    newFormValue[formIndex] = value\n    setFormValue([...newFormValue]);\n  }\n  \n  if(formTemplate){\n    // We assume a valid formTemplate\n    const inputs = formTemplate.map((ele, idx) => {\n      switch(ele.type) {\n        case 'checkbox':\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <Checkbox formIndex={idx} name={ele.name} options={ele.template} defaultValue={ele.defaultValue} value={formValue[idx]} onChange={onChangeHandler}/>\n            </div>\n          )\n        case 'rating':\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <RatingSelector formIndex={idx} name={ele.name} options={ele.template} defaultValue={ele.defaultValue} value={formValue[idx]} onChange={onChangeHandler}/>\n            </div>\n          )\n        case 'grid':\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <GridSelector formIndex={idx} name={ele.name} options={ele.template} defaultValue={ele.defaultValue} value={formValue[idx]} onChange={onChangeHandler}/>\n            </div>\n          )\n        case 'textarea':\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <Textarea formIndex={idx} name={ele.name} options={ele.template} defaultValue={ele.defaultValue} value={formValue[idx]} onChange={onChangeHandler}/>\n            </div>\n          )\n        case 'user_profile':\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <UserProfile value={formValue[idx]}/>\n            </div>\n          )\n        default:\n          return (\n            <div key={idx} className=\"p-2 bg-primary-dark\">\n              <DisplayValue formIndex={idx} name={ele.name} options={ele.template} defaultValue={ele.defaultValue} value={formValue[idx]}/>\n            </div>\n          )      \n      }\n    })\n\n    return (<div>\n      {inputs}\n    </div>)\n  }\n\n  return null\n}\n\nexport default FormGeneratorComponent;\n","import React, { useEffect, useState, useRef, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport FormGeneratorComponent from '../../_shared/FormGeneratorComponent';\nimport LinearProgress from '@mui/material/LinearProgress';\nimport LoadingButton from '@mui/lab/LoadingButton';\nimport ArrowForward from '@mui/icons-material/ArrowForward';\nimport ArrowBack from '@mui/icons-material/ArrowBack';\nimport Paper from '@mui/material/Paper';\nimport Typography from '@mui/material/Typography';\nimport ButtonGroup from '@mui/material/ButtonGroup';\nimport debounce from 'lodash.debounce';\n\nfunction usePrevious(value) {\n  const ref = useRef();\n  useEffect(() => {\n    ref.current = value;\n  });\n  return ref.current;\n}\n\nfunction PanelForm({ servicesManager, extensionManager }) {\n  const { GoogleSheetsService } = servicesManager.services\n  const [formTemplate, setFormTemplate] = useState(GoogleSheetsService.getFormTemplate());\n  const [formValue, setFormValue] = useState(GoogleSheetsService.getFormValue());\n  const [error, setError] = useState(false);\n  const [firstLoad, setFirstLoad] = useState(true);\n  const [initLoading, setInitLoading] = useState(!Boolean(formValue && formTemplate));\n  const [loading, setLoading] = useState(false);\n  const onNext = ()=> GoogleSheetsService.getRow(1)\n  const onPrevious = ()=> GoogleSheetsService.getRow(-1)\n  const debouncedOnNext = useMemo(() => debounce(onNext, 300), []);\n  const debouncedOnPrevious = useMemo(() => debounce(onPrevious, 300), []);\n\n  useEffect(() => {\n    const subscriptions = [];\n    subscriptions.push(\n      GoogleSheetsService.subscribe(GoogleSheetsService.EVENTS.GOOGLE_SHEETS_CHANGE, () => {\n        setFirstLoad(true)\n        setFormValue(GoogleSheetsService.getFormValue())\n        setFormTemplate(GoogleSheetsService.getFormTemplate())\n        setInitLoading(false)\n      }).unsubscribe\n    );\n\n    subscriptions.push(\n      GoogleSheetsService.subscribe(GoogleSheetsService.EVENTS.GOOGLE_SHEETS_ERROR, () => {\n        setError(true)\n      }).unsubscribe\n    );\n    return () => { subscriptions.forEach(unsub=>unsub()) };\n  }, [GoogleSheetsService]);\n\n  useEffect(() => {\n    if(!firstLoad){\n      setLoading(true)\n      GoogleSheetsService.updateRow(formValue).then((values)=>{\n        setLoading(false)\n      })\n    }\n    setFirstLoad(false)\n  }, [formValue]);\n\n  if(error){\n    return (\n      <Paper sx={{ display: 'flex' }} className='p-2'>\n          <Typography sx={{ fontSize: 14, marginRight: 1 }} color=\"text.secondary\" gutterBottom>\n            { \"There was an error connecting to Google Sheets.\" }\n          </Typography>\n      </Paper>\n    )\n  }\n\n  if(!initLoading){\n    return (\n      <> \n        <div style={{color:\"white\", overflow: \"auto\"}}>\n            { loading ? <LinearProgress/> : <div style={{height: '4px'}}></div> }\n            <FormGeneratorComponent\n                formTemplate={formTemplate} \n                formValue={formValue}\n                setFormValue={setFormValue}/>\n        </div>\n        <div className=\"flex justify-center p-4\">\n          <Paper>\n            <ButtonGroup variant=\"contained\" aria-label=\"outlined primary button group\">\n              <LoadingButton\n                loading={loading}\n                loadingPosition=\"start\"\n                startIcon={<ArrowBack />}\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={debouncedOnPrevious}\n              >\n                Prev\n              </LoadingButton>\n              <LoadingButton\n                loading={loading}\n                loadingPosition=\"end\"\n                endIcon={<ArrowForward />}\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={debouncedOnNext}\n              >\n                Next\n              </LoadingButton>\n            </ButtonGroup>\n          </Paper>\n        </div>\n      </>\n    )\n  }\n  \n  return <LinearProgress/>\n}\n\nPanelForm.propTypes = {\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n    }).isRequired,\n  }).isRequired,\n};\n\nexport default PanelForm;\n","import React from 'react';\nimport PanelForm from '../PanelForm'\nimport PanelMeasurementTableTracking from '../PanelMeasurementTableTracking';\nimport PropTypes from 'prop-types';\nimport Divider from '@mui/material/Divider';\n\nfunction PanelFormAndMeasurementTable({ servicesManager, extensionManager }) {\n    return (\n      <React.Fragment>\n          <div style={{height: \"150px\", overflowY: \"auto\"}}>\n            <PanelMeasurementTableTracking servicesManager={servicesManager} extensionManager={extensionManager}/>\n          </div>\n          <div className=\"m-2\">\n            <Divider style={{background: \"white\"}}/>\n          </div>\n          <PanelForm servicesManager={servicesManager} extensionManager={extensionManager}/>\n      </React.Fragment>\n    )\n}\n\nPanelFormAndMeasurementTable.propTypes = {\n  servicesManager: PropTypes.shape({\n    services: PropTypes.shape({\n    }).isRequired,\n  }).isRequired,\n};\n\nexport default PanelFormAndMeasurementTable;\n","import React, { useState, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport { StudyBrowser, useImageViewer, useViewportGrid } from '@ohif/ui';\nimport { utils } from '@ohif/core';\nimport { useNavigate } from 'react-router-dom';\n\nconst { sortStudyInstances, formatDate } = utils;\n\n/**\n *\n * @param {*} param0\n */\nfunction PanelStudyBrowser({\n  servicesManager,\n  getImageSrc,\n  getStudiesForPatientByMRN,\n  requestDisplaySetCreationForStudy,\n  dataSource,\n}) {\n  const { hangingProtocolService, displaySetService, uiNotificationService, GoogleSheetsService } =\n    servicesManager.services;\n  const navigate = useNavigate();\n\n  // Normally you nest the components so the tree isn't so deep, and the data\n  // doesn't have to have such an intense shape. This works well enough for now.\n  // Tabs --> Studies --> DisplaySets --> Thumbnails\n  const { StudyInstanceUIDs } = useImageViewer();\n  const [studyInstanceUIDs, setStudyInstanceUIDs] = useState([...StudyInstanceUIDs]);\n  const [{ activeViewportId, viewports }, viewportGridService] = useViewportGrid();\n  const [activeTabName, setActiveTabName] = useState('primary');\n  const [expandedStudyInstanceUIDs, setExpandedStudyInstanceUIDs] = useState([\n    ...studyInstanceUIDs,\n  ]);\n  const [studyDisplayList, setStudyDisplayList] = useState([]);\n  const [displaySets, setDisplaySets] = useState([]);\n  const [thumbnailImageSrcMap, setThumbnailImageSrcMap] = useState({});\n\n  const onDoubleClickThumbnailHandler = displaySetInstanceUID => {\n    let updatedViewports = [];\n    const viewportId = activeViewportId;\n    try {\n      updatedViewports = hangingProtocolService.getViewportsRequireUpdate(\n        viewportId,\n        displaySetInstanceUID\n      );\n    } catch (error) {\n      console.warn(error);\n      uiNotificationService.show({\n        title: 'Thumbnail Double Click',\n        message: 'The selected display sets could not be added to the viewport.',\n        type: 'info',\n        duration: 3000,\n      });\n    }\n\n    viewportGridService.setDisplaySetsForViewports(updatedViewports);\n  };\n\n  useEffect(() => {\n    setStudyInstanceUIDs([...StudyInstanceUIDs]);\n    setExpandedStudyInstanceUIDs([...StudyInstanceUIDs]);\n  }, [StudyInstanceUIDs]);\n\n  // ~~ studyDisplayList\n  useEffect(() => {\n    // Fetch all studies for the patient in each primary study\n    async function fetchStudiesForPatient(StudyInstanceUID) {\n      // current study qido\n      const qidoForStudyUID = await dataSource.query.studies.search({\n        studyInstanceUid: StudyInstanceUID,\n      });\n\n      if (!qidoForStudyUID?.length) {\n        navigate('/notfoundstudy', '_self');\n        throw new Error('Invalid study URL');\n      }\n\n      let qidoStudiesForPatient = qidoForStudyUID;\n\n      // try to fetch the prior studies based on the patientID if the\n      // server can respond.\n      try {\n        qidoStudiesForPatient = await getStudiesForPatientByMRN(qidoForStudyUID);\n      } catch (error) {\n        console.warn(error);\n      }\n\n      const mappedStudies = _mapDataSourceStudies(qidoStudiesForPatient);\n      const actuallyMappedStudies = mappedStudies.map(qidoStudy => {\n        return {\n          studyInstanceUid: qidoStudy.StudyInstanceUID,\n          date: formatDate(qidoStudy.StudyDate),\n          description: qidoStudy.StudyDescription,\n          modalities: qidoStudy.ModalitiesInStudy,\n          numInstances: qidoStudy.NumInstances,\n        };\n      });\n\n      setStudyDisplayList(prevArray => {\n        const ret = [...prevArray];\n        for (const study of actuallyMappedStudies) {\n          if (!prevArray.find(it => it.studyInstanceUid === study.studyInstanceUid)) {\n            ret.push(study);\n          }\n        }\n        return ret;\n      });\n    }\n\n    studyInstanceUIDs.forEach(sid => fetchStudiesForPatient(sid));\n  }, [studyInstanceUIDs, dataSource, getStudiesForPatientByMRN, navigate]);\n\n  // // ~~ Initial Thumbnails\n  useEffect(() => {\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n    currentDisplaySets.forEach(async dSet => {\n      const newImageSrcEntry = {};\n      const displaySet = displaySetService.getDisplaySetByUID(dSet.displaySetInstanceUID);\n      const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n      const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n      // TODO: Is it okay that imageIds are not returned here for SR displaySets?\n      if (!imageId || displaySet?.unsupported) {\n        return;\n      }\n      // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n      newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(imageId);\n\n      setThumbnailImageSrcMap(prevState => {\n        return { ...prevState, ...newImageSrcEntry };\n      });\n    });\n  }, [studyInstanceUIDs, dataSource, displaySetService, getImageSrc]);\n\n  // ~~ displaySets\n  useEffect(() => {\n    // TODO: Are we sure `activeDisplaySets` will always be accurate?\n    const currentDisplaySets = displaySetService.activeDisplaySets;\n    const mappedDisplaySets = _mapDisplaySets(currentDisplaySets, thumbnailImageSrcMap);\n    sortStudyInstances(mappedDisplaySets);\n\n    setDisplaySets(mappedDisplaySets);\n  }, [studyInstanceUIDs, thumbnailImageSrcMap, displaySetService]);\n\n  // ~~ subscriptions --> displaySets\n  useEffect(() => {\n    // DISPLAY_SETS_ADDED returns an array of DisplaySets that were added\n    const SubscriptionDisplaySetsAdded = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_ADDED,\n      data => {\n        const { displaySetsAdded, options } = data;\n        displaySetsAdded.forEach(async dSet => {\n          const newImageSrcEntry = {};\n          const displaySet = displaySetService.getDisplaySetByUID(dSet.displaySetInstanceUID);\n          if (displaySet?.unsupported) {\n            return;\n          }\n\n          const imageIds = dataSource.getImageIdsForDisplaySet(displaySet);\n          const imageId = imageIds[Math.floor(imageIds.length / 2)];\n\n          // TODO: Is it okay that imageIds are not returned here for SR displaysets?\n          if (!imageId) {\n            return;\n          }\n          // When the image arrives, render it and store the result in the thumbnailImgSrcMap\n          newImageSrcEntry[dSet.displaySetInstanceUID] = await getImageSrc(\n            imageId,\n            dSet.initialViewport\n          );\n\n          setThumbnailImageSrcMap(prevState => {\n            return { ...prevState, ...newImageSrcEntry };\n          });\n        });\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsAdded.unsubscribe();\n    };\n  }, [getImageSrc, dataSource, displaySetService]);\n\n  useEffect(() => {\n    // TODO: Will this always hold _all_ the displaySets we care about?\n    // DISPLAY_SETS_CHANGED returns `DisplaySerService.activeDisplaySets`\n    const SubscriptionDisplaySetsChanged = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SETS_CHANGED,\n      changedDisplaySets => {\n        const mappedDisplaySets = _mapDisplaySets(changedDisplaySets, thumbnailImageSrcMap);\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    const SubscriptionDisplaySetMetaDataInvalidated = displaySetService.subscribe(\n      displaySetService.EVENTS.DISPLAY_SET_SERIES_METADATA_INVALIDATED,\n      () => {\n        const mappedDisplaySets = _mapDisplaySets(\n          displaySetService.getActiveDisplaySets(),\n          thumbnailImageSrcMap\n        );\n\n        setDisplaySets(mappedDisplaySets);\n      }\n    );\n\n    return () => {\n      SubscriptionDisplaySetsChanged.unsubscribe();\n      SubscriptionDisplaySetMetaDataInvalidated.unsubscribe();\n    };\n  }, [studyInstanceUIDs, thumbnailImageSrcMap, displaySetService]);\n\n  useEffect(() => {\n    const { unsubscribe } = GoogleSheetsService.subscribe(\n      GoogleSheetsService.EVENTS.GOOGLE_SHEETS_CHANGE,\n      () => {\n        const newStudyInstanceUID = Object.entries(GoogleSheetsService.studyUIDToIndex).filter(\n          ([key, val]) => val === GoogleSheetsService.index\n        )[0][0];\n\n        if (!studyInstanceUIDs.includes(newStudyInstanceUID)) {\n          setStudyInstanceUIDs([newStudyInstanceUID]);\n          setExpandedStudyInstanceUIDs([newStudyInstanceUID]);\n        }\n      }\n    );\n\n    return () => {\n      unsubscribe();\n    };\n  });\n\n  const tabs = _createStudyBrowserTabs(studyInstanceUIDs, studyDisplayList, displaySets);\n\n  // TODO: Should not fire this on \"close\"\n  function _handleStudyClick(StudyInstanceUID) {\n    const shouldCollapseStudy = expandedStudyInstanceUIDs.includes(StudyInstanceUID);\n    const updatedExpandedStudyInstanceUIDs = shouldCollapseStudy\n      ? // eslint-disable-next-line prettier/prettier\n        [...expandedStudyInstanceUIDs.filter(stdyUid => stdyUid !== StudyInstanceUID)]\n      : [...expandedStudyInstanceUIDs, StudyInstanceUID];\n\n    setExpandedStudyInstanceUIDs(updatedExpandedStudyInstanceUIDs);\n\n    if (!shouldCollapseStudy) {\n      const madeInClient = true;\n      requestDisplaySetCreationForStudy(displaySetService, StudyInstanceUID, madeInClient);\n    }\n  }\n\n  const activeDisplaySetInstanceUIDs = viewports.get(activeViewportId)?.displaySetInstanceUIDs;\n\n  return (\n    <StudyBrowser\n      tabs={tabs}\n      servicesManager={servicesManager}\n      activeTabName={activeTabName}\n      onDoubleClickThumbnail={onDoubleClickThumbnailHandler}\n      activeDisplaySetInstanceUIDs={activeDisplaySetInstanceUIDs}\n      expandedStudyInstanceUIDs={expandedStudyInstanceUIDs}\n      onClickStudy={_handleStudyClick}\n      onClickTab={clickedTabName => {\n        setActiveTabName(clickedTabName);\n      }}\n    />\n  );\n}\n\nPanelStudyBrowser.propTypes = {\n  servicesManager: PropTypes.object.isRequired,\n  dataSource: PropTypes.shape({\n    getImageIdsForDisplaySet: PropTypes.func.isRequired,\n  }).isRequired,\n  getImageSrc: PropTypes.func.isRequired,\n  getStudiesForPatientByMRN: PropTypes.func.isRequired,\n  requestDisplaySetCreationForStudy: PropTypes.func.isRequired,\n};\n\nexport default PanelStudyBrowser;\n\n/**\n * Maps from the DataSource's format to a naturalized object\n *\n * @param {*} studies\n */\nfunction _mapDataSourceStudies(studies) {\n  return studies.map(study => {\n    // TODO: Why does the data source return in this format?\n    return {\n      AccessionNumber: study.accession,\n      StudyDate: study.date,\n      StudyDescription: study.description,\n      NumInstances: study.instances,\n      ModalitiesInStudy: study.modalities,\n      PatientID: study.mrn,\n      PatientName: study.patientName,\n      StudyInstanceUID: study.studyInstanceUid,\n      StudyTime: study.time,\n    };\n  });\n}\n\nfunction _mapDisplaySets(displaySets, thumbnailImageSrcMap) {\n  const thumbnailDisplaySets: any[] = [];\n  const thumbnailNoImageDisplaySets: any[] = [];\n\n  displaySets\n    .filter((ds) => !ds.excludeFromThumbnailBrowser)\n    .forEach((ds) => {\n      const imageSrc = thumbnailImageSrcMap[ds.displaySetInstanceUID];\n      const componentType = _getComponentType(ds);\n\n      const array =\n        componentType === 'thumbnail'\n          ? thumbnailDisplaySets\n          : thumbnailNoImageDisplaySets;\n\n      array.push({\n        displaySetInstanceUID: ds.displaySetInstanceUID,\n        description: ds.SeriesDescription || '',\n        seriesNumber: ds.SeriesNumber,\n        modality: ds.Modality,\n        seriesDate: ds.SeriesDate,\n        seriesTime: ds.SeriesTime,\n        numInstances: ds.numImageFrames,\n        countIcon: ds.countIcon,\n        StudyInstanceUID: ds.StudyInstanceUID,\n        messages: ds.messages,\n        componentType,\n        imageSrc,\n        dragData: {\n          type: 'displayset',\n          displaySetInstanceUID: ds.displaySetInstanceUID,\n          // .. Any other data to pass\n        },\n        isHydratedForDerivedDisplaySet: ds.isHydrated,\n      });\n    });\n\n  return [...thumbnailDisplaySets, ...thumbnailNoImageDisplaySets];\n}\n\nconst thumbnailNoImageModalities = ['SR', 'SEG', 'SM', 'RTSTRUCT', 'RTPLAN', 'RTDOSE'];\n\nfunction _getComponentType(ds) {\n  if (thumbnailNoImageModalities.includes(ds.Modality) || ds?.unsupported) {\n    // TODO probably others.\n    return 'thumbnailNoImage';\n  }\n\n  return 'thumbnail';\n}\n\n/**\n *\n * @param {string[]} primaryStudyInstanceUIDs\n * @param {object[]} studyDisplayList\n * @param {string} studyDisplayList.studyInstanceUid\n * @param {string} studyDisplayList.date\n * @param {string} studyDisplayList.description\n * @param {string} studyDisplayList.modalities\n * @param {number} studyDisplayList.numInstances\n * @param {object[]} displaySets\n * @returns tabs - The prop object expected by the StudyBrowser component\n */\nfunction _createStudyBrowserTabs(primaryStudyInstanceUIDs, studyDisplayList, displaySets) {\n  const primaryStudies = [];\n  const recentStudies = [];\n  const allStudies = [];\n\n  studyDisplayList.forEach(study => {\n    const displaySetsForStudy = displaySets.filter(\n      ds => ds.StudyInstanceUID === study.studyInstanceUid\n    );\n    const tabStudy = Object.assign({}, study, {\n      displaySets: displaySetsForStudy,\n    });\n\n    if (primaryStudyInstanceUIDs.includes(study.studyInstanceUid)) {\n      primaryStudies.push(tabStudy);\n    } else {\n      // TODO: Filter allStudies to dates within one year of current date\n      recentStudies.push(tabStudy);\n      allStudies.push(tabStudy);\n    }\n  });\n\n  const tabs = [\n    {\n      name: 'primary',\n      label: 'Primary',\n      studies: primaryStudies,\n    },\n    {\n      name: 'recent',\n      label: 'Recent',\n      studies: recentStudies,\n    },\n    {\n      name: 'all',\n      label: 'All',\n      studies: allStudies,\n    },\n  ];\n\n  return tabs;\n}\n","import React, { useCallback } from 'react';\nimport PropTypes from 'prop-types';\n\nimport PanelStudyBrowser from './PanelStudyBrowser';\nimport { studyPanelUtilities } from '../utils';\n\nconst {\n  createGetImageSrcFromImageIdFn,\n  createRequestDisplaySetcreationFn,\n  getStudyForPatientUtility,\n} = studyPanelUtilities;\n\n/**\n * Wraps the PanelStudyBrowser and provides features afforded by managers/services\n *\n * @param {object} params\n * @param {object} commandsManager\n * @param {object} extensionManager\n */\nfunction WrappedPanelStudyBrowser({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}) {\n  // TODO: This should be made available a different way; route should have\n  // already determined our datasource\n  const dataSource = extensionManager.getDataSources()[0];\n  const _getStudiesForPatientByMRN = getStudyForPatientUtility(\n    extensionManager,\n    dataSource\n  );\n  const _getImageSrcFromImageId = useCallback(\n    createGetImageSrcFromImageIdFn(extensionManager),\n    []\n  );\n  const _requestDisplaySetCreationForStudy =\n    createRequestDisplaySetcreationFn(dataSource);\n\n  return (\n    <PanelStudyBrowser\n      servicesManager={servicesManager}\n      dataSource={dataSource}\n      getImageSrc={_getImageSrcFromImageId}\n      getStudiesForPatientByMRN={_getStudiesForPatientByMRN}\n      requestDisplaySetCreationForStudy={_requestDisplaySetCreationForStudy}\n    />\n  );\n}\n\nWrappedPanelStudyBrowser.propTypes = {\n  commandsManager: PropTypes.object.isRequired,\n  extensionManager: PropTypes.object.isRequired,\n  servicesManager: PropTypes.object.isRequired,\n};\n\nexport default WrappedPanelStudyBrowser;\n","import {\n  PanelMeasurementTableTracking,\n  PanelStudyBrowserTracking,\n  PanelForm,\n  PanelFormAndMeasurementTable,\n  PanelStudyBrowser,\n} from './panels';\n\n// TODO:\n// - No loading UI exists yet\n// - cancel promises when component is destroyed\n// - show errors in UI for thumbnails if promise fails\nfunction getPanelModule({\n  commandsManager,\n  extensionManager,\n  servicesManager,\n}) {\n  return [\n    {\n      name: 'seriesList',\n      iconName: 'group-layers',\n      iconLabel: 'Studies',\n      label: 'Studies',\n      component: PanelStudyBrowserTracking.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n    {\n      name: 'measurements',\n      iconName: 'list-bullets',\n      iconLabel: 'Measure',\n      label: 'Measurements',\n      component: PanelMeasurementTableTracking.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n    {\n      name: 'form',\n      iconName: 'list-bullets',\n      iconLabel: 'Form',\n      label: 'Form',\n      component: PanelForm.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n    {\n      name: 'form-and-measurements',\n      iconName: 'list-bullets',\n      iconLabel: 'Form',\n      label: 'Form',\n      component: PanelFormAndMeasurementTable.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n    {\n      name: 'seriesList-without-tracking',\n      iconName: 'group-layers',\n      iconLabel: 'Studies',\n      label: 'Studies',\n      component: PanelStudyBrowser.bind(null, {\n        commandsManager,\n        extensionManager,\n        servicesManager,\n      }),\n    },\n  ];\n}\n\nexport default getPanelModule;\n","import React from 'react';\n\nconst Component = React.lazy(() => {\n  return import(\n    /* webpackPrefetch: true */ './viewports/GradientCornerstoneViewport'\n  );\n});\n\nconst OHIFCornerstoneViewport = props => {\n  return (\n    <React.Suspense fallback={<div>Loading...</div>}>\n      <Component {...props} />\n    </React.Suspense>\n  );\n};\n\nfunction getViewportModule({\n  servicesManager,\n  commandsManager,\n  extensionManager,\n}) {\n  const ExtendedOHIFCornerstoneTrackingViewport = props => {\n    return (\n      <OHIFCornerstoneViewport\n        servicesManager={servicesManager}\n        commandsManager={commandsManager}\n        extensionManager={extensionManager}\n        disableViewportOrientationMarkers={true}\n        {...props}\n      />\n    );\n  };\n\n  return [\n    {\n      name: 'cornerstone-gradient',\n      component: ExtendedOHIFCornerstoneTrackingViewport,\n    },\n  ];\n}\n\nexport default getViewportModule;\n","const breastProtocol = {\n    id: 'breast',\n    locked: true,\n    hasUpdatedPriorsInformation: false,\n    name: 'Breast',\n    createdDate: '2021-02-23T19:22:08.894Z',\n    modifiedDate: '2021-02-23T19:22:08.894Z',\n    availableTo: {},\n    editableBy: {},\n    protocolMatchingRules: [],\n    displaySetSelectors: {\n      LMLO: {\n        seriesMatchingRules: [{\n          \"weight\": 5,\n          \"attribute\": \"ImageLaterality\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"L\"\n            }\n          },\n          \"required\": false\n        }, {\n          \"weight\": 5,\n          \"attribute\": \"ViewCodeSequence\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R-10226\"\n            }\n          },\n          \"required\": false\n        }],\n      },\n      LCC: {\n        seriesMatchingRules: [{\n          \"weight\": 5,\n          \"attribute\": \"ImageLaterality\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"L\"\n            }\n          },\n          \"required\": false\n        }, {\n          \"weight\": 5,\n          \"attribute\": \"ViewCodeSequence\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R-10242\"\n            }\n          },\n          \"required\": false\n        }],\n      },\n      RMLO: {\n        seriesMatchingRules: [{\n          \"weight\": 5,\n          \"attribute\": \"ImageLaterality\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R\"\n            }\n          },\n          \"required\": false\n        }, {\n          \"weight\": 5,\n          \"attribute\": \"ViewCodeSequence\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R-10226\"\n            }\n          },\n          \"required\": false\n        }],\n      },\n      RCC: {\n        seriesMatchingRules: [{\n          \"weight\": 5,\n          \"attribute\": \"ImageLaterality\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R\"\n            }\n          },\n          \"required\": false\n        }, {\n          \"weight\": 5,\n          \"attribute\": \"ViewCodeSequence\",\n          \"constraint\": {\n            \"contains\": {\n              \"value\": \"R-10242\"\n            }\n          },\n          \"required\": false\n        }],\n      }\n    },\n    toolGroupIds: ['default'],\n    stages: [\n      {\n        id: 'breast-staging',\n        name: 'Breast Staging',\n        viewportStructure: {\n          type: 'grid',\n          properties: {\n            rows: 1,\n            columns: 4,\n          },\n        },\n        viewports: [\n          {\n            viewportOptions: {\n              toolGroupId: 'default',\n            },\n            displaySets: [{ id: 'RMLO' }],\n          },\n          {\n            viewportOptions: {\n              toolGroupId: 'default',\n            },\n            displaySets: [{ id: 'LMLO' }],\n          },\n          {\n            viewportOptions: {\n              toolGroupId: 'default',\n            },\n            displaySets: [{ id: 'RCC' }],\n          },\n          {\n            viewportOptions: {\n              toolGroupId: 'default',\n            },\n            displaySets: [{ id: 'LCC' }],\n          },\n        ],\n        createdDate: '2021-02-23T18:32:42.850Z',\n      },\n    ],\n    numberOfPriorsReferenced: -1,\n};\n\nfunction getHangingProtocolModule() {\n  return [\n    {\n      name: breastProtocol.id,\n      protocol: breastProtocol,\n    },\n  ];\n}\n\nexport default getHangingProtocolModule;\n","import getWADORSImageId from './getWADORSImageId';\n\nfunction buildInstanceWadoUrl(config, instance) {\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n  const params = [];\n\n  params.push('requestType=WADO');\n  params.push(`studyUID=${StudyInstanceUID}`);\n  params.push(`seriesUID=${SeriesInstanceUID}`);\n  params.push(`objectUID=${SOPInstanceUID}`);\n  params.push('contentType=application/dicom');\n  params.push('transferSyntax=*');\n\n  const paramString = params.join('&');\n\n  return `${config.wadoUriRoot}?${paramString}`;\n}\n\n/**\n * Obtain an imageId for Cornerstone from an image instance\n *\n * @param instance\n * @param frame\n * @param thumbnail\n * @returns {string} The imageId to be used by Cornerstone\n */\nexport default function getImageId({\n  instance,\n  frame,\n  config,\n  thumbnail = false,\n}) {\n  if (!instance) {\n    return;\n  }\n\n  if (instance.url) {\n    return instance.url;\n  }\n\n  const renderingAttr = thumbnail ? 'thumbnailRendering' : 'imageRendering';\n\n  if (!config[renderingAttr] || config[renderingAttr] === 'wadouri') {\n    const wadouri = buildInstanceWadoUrl(config, instance);\n\n    let imageId = 'dicomweb:' + wadouri;\n    if (frame !== undefined) {\n      imageId += '&frame=' + frame;\n    }\n\n    return imageId;\n  } else {\n    return getWADORSImageId(instance, config, frame); // WADO-RS Retrieve Frame\n  }\n}\n","function buildInstanceWadoRsUri(instance, config) {\n  const { StudyInstanceUID, SeriesInstanceUID, SOPInstanceUID } = instance;\n  return `${config.wadoRoot}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/instances/${SOPInstanceUID}`;\n}\n\nfunction buildInstanceFrameWadoRsUri(instance, config, frame) {\n  const baseWadoRsUri = buildInstanceWadoRsUri(instance, config);\n\n  frame = frame || 1;\n\n  return `${baseWadoRsUri}/frames/${frame}`;\n}\n\n// function getWADORSImageUrl(instance, frame) {\n//   const wadorsuri = buildInstanceFrameWadoRsUri(instance, config, frame);\n\n//   if (!wadorsuri) {\n//     return;\n//   }\n\n//   // Use null to obtain an imageId which represents the instance\n//   if (frame === null) {\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, '');\n//   } else {\n//     // We need to sum 1 because WADO-RS frame number is 1-based\n//     frame = frame ? parseInt(frame) + 1 : 1;\n\n//     // Replaces /frame/1 by /frame/{frame}\n//     wadorsuri = wadorsuri.replace(/frames\\/(\\d+)/, `frames/${frame}`);\n//   }\n\n//   return wadorsuri;\n// }\n\n/**\n * Obtain an imageId for Cornerstone based on the WADO-RS scheme\n *\n * @param {object} instanceMetada metadata object (InstanceMetadata)\n * @param {(string\\|number)} [frame] the frame number\n * @returns {string} The imageId to be used by Cornerstone\n */\nexport default function getWADORSImageId(instance, config, frame) {\n  //const uri = getWADORSImageUrl(instance, frame);\n  const uri = buildInstanceFrameWadoRsUri(instance, config, frame);\n\n  if (!uri) {\n    return;\n  }\n\n  return `wadors:${uri}`;\n}\n","import dcmjs from 'dcmjs';\nimport pako from 'pako'\nimport {\n  DicomMetadataStore,\n  IWebApiDataSource,\n  utils,\n  errorHandler,\n  classes,\n} from '@ohif/core';\n\nimport getImageId from '../DicomWebDataSource/utils/getImageId';\nimport _ from 'lodash';\n\nconst metadataProvider = classes.MetadataProvider;\nconst { datasetToBlob } = dcmjs.data;\n\nconst mappings = {\n  studyInstanceUid: 'StudyInstanceUID',\n  patientId: 'PatientID',\n};\n\nlet _store = {\n  urls: [],\n  studyInstanceUIDMap: new Map(), // map of urls to array of study instance UIDs\n  // {\n  //   url: url1\n  //   studies: [Study1, Study2], // if multiple studies\n  // }\n  // {\n  //   url: url2\n  //   studies: [Study1],\n  // }\n  // }\n};\n\nconst getMetaDataByURL = url => {\n  return _store.urls.find(metaData => metaData.url === url);\n};\n\nconst getInstanceUrl = (url, prefix) => {\n  let modifiedUrl = prefix\n    ? url.replace(\n      'https://storage.googleapis.com',\n      `https://storage.googleapis.com/${prefix}`\n    )\n    : url;\n\n  const dicomwebRegex = /^dicomweb:/\n  modifiedUrl = modifiedUrl.includes(\":zip//\")\n    ? modifiedUrl.replace(dicomwebRegex, 'dicomzip:')\n    : modifiedUrl;\n\n  return modifiedUrl;\n}\n\nconst getProperty = (serieMetadata, property) => {\n  return (\n    serieMetadata[property] || serieMetadata.instances[0].metadata[property]\n  );\n};\n\nconst getMetadataFromRows = (rows, prefix, seriesuidArray) => {\n  // TODO: bq should not have dups\n  let filteredRows = rows.map(row => {\n    row.instances = _.uniqBy(row.instances, (x)=>x.url)\n    return row\n  });\n\n  if(!_.isEmpty(seriesuidArray)){\n    filteredRows = filteredRows.filter(row=>{\n      return seriesuidArray.includes(row.SeriesInstanceUID);\n    })\n  }\n\n  const rowsByStudy = Object.values(\n    filteredRows.reduce((rowsByStudy, row) => {\n      const studyuid = row['StudyInstanceUID'];\n      if (!rowsByStudy[studyuid]) rowsByStudy[studyuid] = [];\n      rowsByStudy[studyuid].push(row);\n      return rowsByStudy;\n    }, {})\n  );\n\n  const studies = rowsByStudy.map(rows => {\n    const studyNumInstances = rows.reduce((acc, row) => {\n      return acc + (parseInt(row['NumInstances']) || 0);\n    }, 0);\n\n    const series = rows.map(row => {\n      return {\n        SeriesInstanceUID: row['SeriesInstanceUID'],\n        Modality: row['Modality'],\n        SeriesDescription: row['SeriesDescription'] || 'No description',\n        StudyInstanceUID: row['StudyInstanceUID'],\n        SeriesNumber: row['SeriesNumber'],\n        SeriesDate: row['SeriesDate'],\n        SeriesTime: row['SeriesTime'],\n        NumInstances: isNaN(parseInt(row['NumInstances']))\n          ? 0\n          : parseInt(row['NumInstances']),\n        instances: row['instances'].map(instance => {\n          return {\n            metadata: instance.metadata,\n            url: getInstanceUrl(instance.url, prefix),\n          };\n        }),\n      };\n    });\n\n    return {\n      StudyInstanceUID: getProperty(rows[0], 'StudyInstanceUID'),\n      PatientName: getProperty(rows[0], 'PatientName'),\n      PatientSex: getProperty(rows[0], 'PatientSex') || '',\n      AccessionNumber: getProperty(rows[0], 'AccessionNumber'),\n      StudyDate: getProperty(rows[0], 'StudyDate'),\n      PatientID: getProperty(rows[0], 'PatientID'),\n      PatientWeight: getProperty(rows[0], 'PatientWeight') || '',\n      PatientAge: getProperty(rows[0], 'PatientAge') || '',\n      StudyDescription:\n        getProperty(rows[0], 'StudyDescription') || 'No description',\n      StudyTime: getProperty(rows[0], 'StudyTime'),\n      NumInstances: studyNumInstances,\n      Modalities: `[\"${rows[0]['Modality']}\"]`,\n      series: series,\n    };\n  });\n  return {\n    studies: studies,\n  };\n};\n\nconst getBigQueryRows = async (studyuids, seriesuid, access_token) => {\n  const projectId = 'gradient-health-search';\n  const query = `\n    SELECT TO_JSON_STRING(t) FROM (\n      SELECT\n        StudyInstanceUID,\n        SeriesInstanceUID,\n        PatientID,\n        StudyID,\n        Modality,\n        PatientName,\n        PatientSex,\n        AccessionNumber,\n        StudyDate,\n        PatientWeight,\n        PatientAge,\n        ParsedPatientAge,\n        StudyDescription,\n        StudyTime,\n        NumInstances,\n        SeriesDescription,\n        SeriesNumber\n        SeriesTime,\n        instances\n      FROM \\`gradient-health-search.radiology.all-viewer-links\\`\n      WHERE StudyInstanceUID IN (${studyuids.map(s => `'${s}'`).join(', ')})\n      ${seriesuid ? `AND SeriesInstanceUID = '${seriesuid}'` : ''}\n    ) as t\n  `;\n  const response = await fetch(\n    `https://bigquery.googleapis.com/bigquery/v2/projects/${projectId}/queries`,\n    {\n      method: 'POST',\n      body: JSON.stringify({\n        query: query,\n        useLegacySql: false,\n        location: 'us-central1',\n        defaultDataset: {\n          datasetId: 'radiology',\n          projectId: 'gradient-health-search',\n        },\n      }),\n      headers: {\n        Authorization: 'Bearer ' + access_token,\n        'Content-Type': 'application/json',\n      },\n    }\n  );\n  const data = await response.json();\n  if (data) {\n    return data?.rows.map(row => JSON.parse(row?.f?.[0]?.v));\n  } else {\n    return undefined;\n  }\n};\n\nconst filesFromStudyInstanceUID = async ({bucketName, prefix, studyuids, headers})=>{\n  const studyMetadata = studyuids.map(async (studyuid) => {\n    const folderPath = `${prefix}/studies/${studyuid}/series/`;\n    const delimiter = '/'\n    const apiUrl = `https://storage.googleapis.com/storage/v1/b/${bucketName}/o?prefix=${folderPath}&delimiter=${delimiter}`;\n    const response = await fetch(apiUrl, { headers });\n    const res = await response.json()\n    const files = res.items || [];\n    const folders = res.prefixes || [];\n    const series = folders.map(async (folderPath)=>{\n      const objectName = `${folderPath}metadata`;\n      const apiUrl = `https://storage.googleapis.com/storage/v1/b/${bucketName}/o/${encodeURIComponent(objectName)}?alt=media`;\n      const response = await fetch(apiUrl, { headers });\n      return response.json()\n    })\n    return Promise.all(series)\n  });\n  return await Promise.all(studyMetadata)\n}\n\nconst findStudies = (key, value) => {\n  let studies = [];\n  _store.urls.map(metaData => {\n    metaData.studies.map(aStudy => {\n      if (aStudy[key] === value) {\n        studies.push(aStudy);\n      }\n    });\n  });\n  return studies;\n};\n\nconst mapSegSeriesFromDataSet = (dataSet) => {\n  return {\n    Modality: dataSet.Modality,\n    SeriesInstanceUID: dataSet.SeriesInstanceUID,\n    SeriesDescription: dataSet.SeriesDescription,\n    SeriesNumber: Number(dataSet.SeriesNumber),\n    SeriesDate: dataSet.SeriesDate,\n    SeriesTime: dataSet.SeriesTime,\n    StudyDate: dataSet.StudyDate,\n    StudyTime: dataSet.StudyTime,\n    PatientName: dataSet.PatientName,\n    PatientID: dataSet.PatientID,\n    PatientWeight: dataSet.PatientWeight,\n    PatientAge: Number(dataSet.PatientAge),\n    AccessionNumber: Number(dataSet.AccessionNumber),\n    StudyInstanceUID: dataSet.StudyInstanceUID,\n    StudyDescription: dataSet.StudyDescription,\n    instances: [\n      {\n        metadata: {\n          FrameOfReferenceUID: dataSet.FrameOfReferenceUID,\n          SOPInstanceUID: dataSet.SOPInstanceUID,\n          SOPClassUID: dataSet.SOPClassUID,\n          ReferencedSeriesSequence: dataSet.ReferencedSeriesSequence,\n          SharedFunctionalGroupsSequence:\n            dataSet.SharedFunctionalGroupsSequence,\n          PerFrameFunctionalGroupsSequence:\n            dataSet.PerFrameFunctionalGroupsSequence,\n          SegmentSequence: dataSet.SegmentSequence,\n          Manufacturer: dataSet.Manufacturer,\n        },\n        url: dataSet.url,\n      },\n    ],\n  };\n};\n\nconst storeDicomSeg = async (naturalizedReport, headers, displaySetService) => {\n  const {\n    StudyInstanceUID,\n    SeriesInstanceUID,\n    SOPInstanceUID,\n    SeriesDescription,\n  } = naturalizedReport;\n\n  const params = new URLSearchParams(window.location.search);\n  const buckets = params.getAll('bucket');\n  const bucket =\n    buckets[1] || buckets[0] || 'gradient-health-search-viewer-links';\n  const prefix = params.get('bucket-prefix') || 'dicomweb';\n  let segBucket = params.get('seg-bucket') || bucket\n  const segPrefix = params.get('seg-prefix') || prefix\n  const filteredDescription = SeriesDescription.replace(/[/]/g, '');\n\n  let fileName = `${segPrefix}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/instances/${SOPInstanceUID}/${encodeURIComponent(\n    filteredDescription\n  )}.dcm`;\n\n  const segDisplaySet = displaySetService.getDisplaySetsBy(\n    (ds) =>\n      ds.SeriesInstanceUID === SeriesInstanceUID &&\n      ds.instance.SOPInstanceUID === SOPInstanceUID\n  )[0];\n  if (segDisplaySet) {\n    const url = segDisplaySet.instance.url;\n    segBucket = url.split('https://storage.googleapis.com/')[1].split('/')[0];\n    fileName = url.split(`https://storage.googleapis.com/${segBucket}/`)[1];\n  }\n\n  const segUploadUri = `https://storage.googleapis.com/upload/storage/v1/b/${segBucket}/o?uploadType=media&name=${fileName}&contentEncoding=gzip`;\n  const blob = datasetToBlob(naturalizedReport);\n  const compressedFile = pako.gzip(await blob.arrayBuffer());\n\n  await fetch(segUploadUri, {\n    method: 'POST',\n    headers: {\n      ...headers,\n      'Content-Type': 'application/dicom',\n    },\n    body: compressedFile,\n  })\n    .then((response) => response.json())\n    .then((data) => {\n      if (data.error) {\n        throw new Error(\n          `${data.error.code}: ${data.error.message}`\n        );\n      }\n\n      const segUri = `dicomweb:https://storage.googleapis.com/${segBucket}/${data.name}`;\n      // We are storing the imageId so that when naturalizedReport is made to displayset we can get url to DicomSeg file.\n      naturalizedReport.url = segUri\n      const segSeries = mapSegSeriesFromDataSet(naturalizedReport);\n      const compressedFile = pako.gzip(JSON.stringify(segSeries));\n\n      return fetch(\n        `https://storage.googleapis.com/upload/storage/v1/b/${segBucket}/o?uploadType=media&name=${segPrefix}/studies/${StudyInstanceUID}/series/${SeriesInstanceUID}/metadata&contentEncoding=gzip`,\n        {\n          method: 'POST',\n          headers: {\n            ...headers,\n            'Content-Type': 'application/json',\n          },\n          body: compressedFile,\n        }\n      )\n        .then((response) => response.json())\n        .then((data) => {\n          if (data.error) {\n            throw new Error(\n              `${data.error.code}: ${data.error.message}`\n            );\n          }\n        })\n        .catch((error) => {\n          throw new Error(error.message || 'Failed to store DicomSeg metadata')\n        })\n    })\n    .catch((error) => {\n      throw new Error(error.message || 'Failed to store DicomSeg file')\n    })\n};\n\nlet _dicomJsonConfig = null;\n\nfunction createDicomJSONApi(dicomJsonConfig, servicesManager) {\n  var { name, wadoRoot } = dicomJsonConfig;\n  const init = config => {\n    _dicomJsonConfig = config;\n    name = _dicomJsonConfig.name;\n    wadoRoot = _dicomJsonConfig.wadoRoot;\n  };\n\n  init(dicomJsonConfig);\n\n  const implementation = {\n    updateConfig: (dicomWebConfig) => {\n      init(dicomWebConfig);\n    },\n    initialize: async ({ params, query, url }) => {\n      if (!url) url = query.get('url');\n      if (!url) {\n        url = query.toString();\n        query.set('url', url);\n      }\n      let metaData = getMetaDataByURL(url);\n\n      // if we have already cached the data from this specific url\n      // We are only handling one StudyInstanceUID to run; however,\n      // all studies for patientID will be put in the correct tab\n      if (metaData) {\n        return metaData.studies.map(aStudy => {\n          return aStudy.StudyInstanceUID;\n        });\n      }\n\n      const buckets = query.getAll('bucket');\n      if (buckets.length === 0)\n        buckets.push('gradient-health-search-viewer-links');\n\n      const { UserAuthenticationService } = servicesManager.services;\n\n      const studyMetadata = [];\n      for (let i = 0; i < buckets.length; i++) {\n        const metadataPerBucket = await filesFromStudyInstanceUID({\n          bucketName: buckets[i],\n          prefix: query.get('bucket-prefix') || 'dicomweb',\n          studyuids: query.getAll('StudyInstanceUID'),\n          headers: UserAuthenticationService.getAuthorizationHeader(),\n        });\n\n        studyMetadata.push(...metadataPerBucket);\n      }\n\n      const data = getMetadataFromRows(\n        _.flatten(studyMetadata),\n        query.get('prefix'),\n        query.getAll('SeriesInstanceUID')\n      );\n\n      let StudyInstanceUID;\n      let SeriesInstanceUID;\n      data.studies.forEach(study => {\n        StudyInstanceUID = study.StudyInstanceUID;\n\n        study.series.forEach(series => {\n          SeriesInstanceUID = series.SeriesInstanceUID;\n\n          series.instances.forEach(instance => {\n            const { url: imageId, metadata: naturalizedDicom } = instance;\n\n            // Add imageId specific mapping to this data as the URL isn't necessarliy WADO-URI.\n            metadataProvider.addImageIdToUIDs(imageId, {\n              StudyInstanceUID,\n              SeriesInstanceUID,\n              SOPInstanceUID: naturalizedDicom.SOPInstanceUID,\n            });\n          });\n        });\n      });\n\n      _store.urls.push({\n        url,\n        studies: [...data.studies],\n      });\n\n      _store.studyInstanceUIDMap.set(\n        url,\n        data.studies.map(study => study.StudyInstanceUID)\n      );\n    },\n    query: {\n      studies: {\n        mapParams: () => { },\n        search: async param => {\n          const [key, value] = Object.entries(param)[0];\n          const mappedParam = mappings[key];\n\n          // todo: should fetch from dicomMetadataStore\n          const studies = findStudies(mappedParam, value);\n\n          return studies.map(aStudy => {\n            return {\n              accession: aStudy.AccessionNumber,\n              date: aStudy.StudyDate,\n              description: aStudy.StudyDescription,\n              instances: aStudy.NumInstances,\n              modalities: aStudy.Modalities,\n              mrn: aStudy.PatientID,\n              patientName: aStudy.PatientName,\n              studyInstanceUid: aStudy.StudyInstanceUID,\n              NumInstances: aStudy.NumInstances,\n              time: aStudy.StudyTime,\n            };\n          });\n        },\n        processResults: () => {\n          console.debug(' DICOMJson QUERY processResults');\n        },\n      },\n      series: {\n        // mapParams: mapParams.bind(),\n        search: () => {\n          console.debug(' DICOMJson QUERY SERIES SEARCH');\n        },\n      },\n      instances: {\n        search: () => {\n          console.debug(' DICOMJson QUERY instances SEARCH');\n        },\n      },\n    },\n    retrieve: {\n      directURL: params => {\n        console.debug('Not implemented', params)\n      },\n      series: {\n        metadata: async ({\n          StudyInstanceUID,\n          buckets = [],\n          madeInClient = false,\n          customSort,\n        } = {}) => {\n          if (!StudyInstanceUID) {\n            throw new Error(\n              'Unable to query for SeriesMetadata without StudyInstanceUID'\n            );\n          }\n\n          let study = findStudies('StudyInstanceUID', StudyInstanceUID)[0];\n\n          if (!study) {\n            // If the study is not found, initialize the study.\n            // If there is no buckets in the url default bucket will be used.\n            const params = new URLSearchParams(window.location.search);\n            params.set('StudyInstanceUID', StudyInstanceUID);\n            params.delete('bucket');\n            buckets.forEach((bucket) => {\n              params.append('bucket', bucket);\n            });\n            await implementation.initialize({ query: params });\n\n            study = findStudies('StudyInstanceUID', StudyInstanceUID)[0];\n          }\n\n          let series;\n\n          if (customSort) {\n            series = customSort(study.series);\n          } else {\n            series = study.series;\n          }\n\n          const seriesSummaryMetadata = series.map(series => {\n            const seriesSummary = {\n              StudyInstanceUID: study.StudyInstanceUID,\n              ...series,\n            };\n            delete seriesSummary.instances;\n            return seriesSummary;\n          });\n\n          // Async load series, store as retrieved\n          function storeInstances(naturalizedInstances) {\n            DicomMetadataStore.addInstances(naturalizedInstances, madeInClient);\n          }\n\n          DicomMetadataStore.addSeriesMetadata(\n            seriesSummaryMetadata,\n            madeInClient\n          );\n\n          function setSuccessFlag() {\n            const study = DicomMetadataStore.getStudy(\n              StudyInstanceUID,\n              madeInClient\n            );\n            study.isLoaded = true;\n          }\n\n          const numberOfSeries = series.length;\n          series.forEach((series, index) => {\n            const instances = series.instances.map(instance => {\n              const obj = {\n                ...instance.metadata,\n                url: instance.url,\n                imageId: instance.url,\n                ...series,\n                ...study,\n              };\n              delete obj.instances;\n              delete obj.series;\n              return obj;\n            });\n            storeInstances(instances);\n            if (index === numberOfSeries - 1) setSuccessFlag();\n          });\n        },\n      },\n    },\n    store: {\n      dicom: async (dataset) => {\n        if (dataset.Modality === 'SEG') {\n          const headers = servicesManager.services.UserAuthenticationService.getAuthorizationHeader()\n          try {\n            await storeDicomSeg(\n              dataset,\n              headers,\n              servicesManager.services.displaySetService\n            );\n          } catch (error) {\n            throw error\n          }\n        } else {\n          console.debug(' DICOMJson store dicom');\n        }\n      },\n    },\n    getImageIdsForDisplaySet(displaySet) {\n      const images = displaySet.images;\n      const imageIds = [];\n\n      if (!images) {\n        return imageIds;\n      }\n\n      displaySet.images.forEach(instance => {\n        const NumberOfFrames = instance.NumberOfFrames;\n\n        if (NumberOfFrames > 1) {\n          for (let i = 0; i < NumberOfFrames; i++) {\n            const imageId = getImageId({\n              instance,\n              frame: i,\n              config: _dicomJsonConfig,\n            });\n            imageIds.push(imageId);\n          }\n        } else {\n          const imageId = getImageId({ instance, config: _dicomJsonConfig });\n          imageIds.push(imageId);\n        }\n      });\n\n      return imageIds;\n    },\n    getImageIdsForInstance({ instance, frame }) {\n      const imageIds = getImageId({\n        instance,\n        frame,\n      });\n      return imageIds;\n    },\n\n    getStudyInstanceUIDs: ({ params, query }) => {\n      const url = query.get('url');\n      return _store.studyInstanceUIDMap.get(url);\n    },\n  };\n  return IWebApiDataSource.create(implementation);\n}\n\nexport { createDicomJSONApi };\n","// TODO: Pull in IWebClientApi from @ohif/core\n// TODO: Use constructor to create an instance of IWebClientApi\n// TODO: Use existing DICOMWeb configuration (previously, appConfig, to configure instance)\n\nimport { createDicomJSONApi } from './DicomJSONDataSource/index.js';\n\n/**\n *\n */\nfunction getDataSourcesModule({servicesManager}) {\n  return [\n    {\n      name: 'bq',\n      type: 'jsonApi',\n      createDataSource: dicomJsonConfig => {\n        return createDicomJSONApi(dicomJsonConfig, servicesManager);\n      },\n    },\n  ];\n}\n\nexport default getDataSourcesModule;\n","import packageJson from '../package.json';\n\nconst id = packageJson.name;\n\nexport { id };\n","const letters = [\n\t\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\",\n\t\"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\",\n\t\"W\", \"X\", \"Y\", \"Z\"\n]\nlet a = [...letters]\nletters.forEach((letter_1)=>{\n    letters.forEach((letter_2)=>{\n\t\ta.push(letter_1 + letter_2)\n\t})\n})\n\nexport const alphabet = [...a]\n\n// Return array of string values, or NULL if CSV string not well formed.\nexport function CSVtoArray(text) {\n    let p = '', row = [''], ret = [row], i = 0, r = 0, s = !0, l;\n    for (l of text) {\n        if ('\"' === l) {\n            if (s && l === p) row[i] += l;\n            s = !s;\n        } else if (',' === l && s) l = row[++i] = '';\n        else if ('\\n' === l && s) {\n            if ('\\r' === p) row[i] = row[i].slice(0, -1);\n            row = ret[++r] = [l = '']; i = 0;\n        } else row[i] += l;\n        p = l;\n    }\n    return ret;\n};\n\n","import { eventTarget, Enums, cache } from '@cornerstonejs/core';\nimport { utilities as csToolsUtils } from '@cornerstonejs/tools';\nimport { DicomMetadataStore, pubSubServiceInterface } from '@ohif/core';\nimport { alphabet } from './utils';\n\nconst MAX_ROWS = 100000;\n\nconst EVENTS = {\n  GOOGLE_SHEETS_CHANGE: 'event::gradienthealth::GoogleSheets:FormChange',\n  GOOGLE_SHEETS_ERROR: 'event::gradienthealth::GoogleSheets:Error',\n  GOOGLE_SHEETS_DESTROY: 'event::gradienthealth::GoogleSheets:Destroy',\n};\n\nconst convertFormValues = (v) => {\n  switch (v) {\n    case 'TRUE':\n      return true;\n    case 'FALSE':\n      return false;\n    case 'YES':\n      return true;\n    case 'NO':\n      return false;\n    case '':\n      return null;\n    case undefined:\n      return null;\n  }\n  return v;\n};\n\nexport default class GoogleSheetsService {\n  constructor(serviceManager, commandsManager, extensionManager) {\n    this.serviceManager = serviceManager;\n    this.listeners = {};\n    this.api_key = 'AIzaSyDu5Rt54oHX1w3O5kZTARz7DClaxNjTpEs'; // This is our API key\n    this.EVENTS = EVENTS;\n    this.sheetId = null;\n    this.index = null;\n    this.sheetName = null;\n    this.formTemplate = null;\n    this.formValue = null;\n    this.settings = null;\n    this.formHeader = null;\n    this.rows = null;\n    this.studyUIDToIndex = {};\n    this.extensionManager = extensionManager;\n    this.DicomMetadataStore = DicomMetadataStore;\n    Object.assign(this, pubSubServiceInterface);\n  }\n\n  cacheNearbyStudyInstanceUIDs(id, bufferBack, bufferFront) {\n    const { CacheAPIService } = this.serviceManager.services;\n    const index = this.studyUIDToIndex[id];\n    const min = index - bufferBack < 2 ? 2 : index - bufferBack;\n    const max = index + bufferFront;\n    const urlIndex = this.formHeader.findIndex((name) => name == 'URL');\n    const studyIdIndex = this.formHeader.findIndex((name) => name == 'ID');\n\n    const rowsToCache = this.rows.slice(min - 1, max);\n    const indexOfCurrentId = rowsToCache.findIndex(\n      (row) => row[studyIdIndex] === id\n    );\n    const element = rowsToCache.splice(indexOfCurrentId, 1);\n    rowsToCache.unshift(element[0]); // making the current studyid as first element\n\n    rowsToCache.reduce((promise, row) => {\n      return promise.then(() => {\n        const url = row[urlIndex];\n        const params = new URLSearchParams('?' + url.split('?')[1]);\n        const StudyInstanceUID = getStudyInstanceUIDFromParams(params);\n        return CacheAPIService.cacheStudy(\n          StudyInstanceUID,\n          params.getAll('bucket')\n        );\n      });\n    }, Promise.resolve());\n  }\n\n  setFormByStudyInstanceUID(id) {\n    const index = this.studyUIDToIndex[id];\n    this.setFormByIndex(index);\n    this.cacheNearbyStudyInstanceUIDs(id, 2, 32);\n  }\n\n  setFormByIndex(index) {\n    this.index = index;\n    const rowValues = this.rows[index - 1]; // google sheets is 1-indexed\n    this.formValue = this.readFormValue(rowValues);\n    this._broadcastEvent(EVENTS.GOOGLE_SHEETS_CHANGE);\n  }\n\n  async init() {\n    try {\n      const { UserAuthenticationService } = this.serviceManager.services;\n      this.user = UserAuthenticationService.getUser();\n      const params = new URLSearchParams(window.location.search);\n\n      if (window.location.pathname.startsWith('/segmentation')) {\n        // Since sheet panel only used by segmentation and breast density mode,\n        // and breast density mode does not handles segmentation we are only loading\n        // segmentations in segmentation mode.\n        eventTarget.addEventListener(\n          Enums.Events.STACK_VIEWPORT_NEW_STACK,\n          () => loadSegFiles(this.serviceManager)\n        );\n      }\n\n      if (!params.get('sheetId'))\n        return this._broadcastEvent(EVENTS.GOOGLE_SHEETS_ERROR);\n      if (!params.get('sheetName'))\n        return this._broadcastEvent(EVENTS.GOOGLE_SHEETS_ERROR);\n      this.sheetId = params.get('sheetId');\n      this.sheetName = params.get('sheetName');\n\n      // Get settings config from sheets\n      this.settings = await this.readRange(1, 6, this.sheetId, 'Settings');\n\n      // Get values for current row from sheets\n      this.formHeader = (await this.readRange(1, 1)).values[0];\n\n      // TODO: Handle more than MAX_ROWS\n      this.rows = (await this.readRange(1, MAX_ROWS)).values;\n      this.formHeader = this.rows[0];\n\n      const urlIndex = this.formHeader.findIndex((name) => name == 'URL');\n      this.studyUIDToIndex = this.rows.slice(1).reduce((prev, curr, idx) => {\n        const url = curr[urlIndex];\n        const params = new URLSearchParams('?' + url.split('?')[1]);\n        const StudyInstanceUID = getStudyInstanceUIDFromParams(params);\n\n        // Google Sheets is 1-indexed and we ignore first row as header row thus + 2\n        prev[StudyInstanceUID] = idx + 2;\n        return prev;\n      }, {});\n\n      this.index = this.studyUIDToIndex[getStudyInstanceUIDFromParams(params)];\n\n      // Map formTemplate and formValue\n      const values = this.settings.values[0].map((_, colIndex) =>\n        this.settings.values.map((row) => row[colIndex])\n      );\n      const header = values[0];\n      this.formTemplate = values\n        .slice(1, -1)\n        .map((col) => {\n          return col.reduce((obj, curr, idx) => {\n            curr = convertFormValues(curr);\n\n            switch (header[idx]) {\n              case 'template':\n                try {\n                  if (curr) obj[header[idx]] = JSON.parse(curr);\n                } catch (e) {\n                  console.warn(curr, e);\n                }\n                break;\n              case 'order':\n                obj[header[idx]] = Number(curr);\n                break;\n              default:\n                obj[header[idx]] = curr;\n            }\n            return obj;\n          }, {});\n        })\n        .filter((ele) => {\n          return ele.show;\n        })\n        .sort((a, b) => a.order - b.order);\n\n      this.setFormByStudyInstanceUID(getStudyInstanceUIDFromParams(params));\n    } catch (e) {\n      console.error(e);\n      this._broadcastEvent(EVENTS.GOOGLE_SHEETS_ERROR);\n    }\n  }\n\n  readFormValue(x) {\n    return this.formTemplate.map((ele) => {\n      const index = this.formHeader.findIndex((name) => name == ele.name);\n      if (index !== -1) {\n        return convertFormValues(x[index]);\n      }\n    });\n  }\n\n  async readRange(\n    min,\n    max,\n    sheetId = this.sheetId,\n    sheetName = this.sheetName\n  ) {\n    const range = `A${min}:ZZ${max}`;\n    const baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}`;\n    const response = await fetch(baseUrl, {\n      headers: {\n        Authorization: 'Bearer ' + this.user['access_token'],\n      },\n    });\n    const responseJson = await response.json();\n    return responseJson;\n  }\n\n  // Must be XHR to avoid sheets CORS issue\n  writeRange(sheetId, sheetName, range, values) {\n    return new Promise((resolve, reject) => {\n      let baseUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}!${range}?valueInputOption=USER_ENTERED`;\n      var xhr = new XMLHttpRequest();\n      xhr.open('PUT', baseUrl);\n      xhr.setRequestHeader('Content-type', 'application/json');\n      xhr.setRequestHeader(\n        'Authorization',\n        'Bearer ' + this.user['access_token']\n      );\n      xhr.onload = () => {\n        if (xhr.status == 200) {\n          resolve();\n        } else {\n          reject();\n        }\n      };\n      xhr.send(\n        JSON.stringify({\n          range: `${sheetName}!${range}`,\n          majorDimension: 'ROWS',\n          values: [values],\n        })\n      );\n    });\n  }\n\n  async updateRow(formValue) {\n    const values = this.formHeader.map((colName) => {\n      const index = this.formTemplate.findIndex((ele) => {\n        return colName == ele.name;\n      });\n      if (index > 0) {\n        return formValue[index];\n      }\n\n      if (colName === 'Updated By') {\n        const user =\n          this.serviceManager.services.UserAuthenticationService.getUser();\n        return JSON.stringify({\n          email: user.profile.email,\n          picture: user.profile.picture,\n          lastUpdated: Date.now(),\n        });\n      }\n      return null;\n    });\n\n    // google sheets is 1-indexed, so take rows[index-1]\n    const updatedFormValue = this.rows[this.index - 1].map((element, index) =>\n      values[index] !== null ? values[index] : element\n    );\n\n    this.rows[this.index - 1] = updatedFormValue;\n    this.formValue = formValue\n\n    await this.writeRange(\n      this.sheetId,\n      this.sheetName,\n      `A${this.index}:${alphabet[this.formHeader.length - 1]}${this.index}`,\n      values\n    );\n    return values;\n  }\n\n  getFormTemplate() {\n    return this.formTemplate ? this.formTemplate : null;\n  }\n\n  getFormValue() {\n    return this.formValue ? this.formValue : null;\n  }\n\n  async getRow(delta) {\n    try {\n      const {\n        DisplaySetService,\n        HangingProtocolService,\n        CacheAPIService,\n        SegmentationService,\n      } = this.serviceManager.services;\n      const rowValues = this.rows[this.index + delta - 1];\n      if (!rowValues) {\n        window.location.href = `https://docs.google.com/spreadsheets/d/${this.sheetId}`;\n      }\n      const index = this.formHeader.findIndex((name) => name == 'URL');\n      const url = rowValues[index];\n      const params = new URLSearchParams('?' + url.split('?')[1]);\n      const StudyInstanceUID = getStudyInstanceUIDFromParams(params);\n      const buckets = params.getAll('bucket');\n      if (!StudyInstanceUID) {\n        window.location.href = `https://docs.google.com/spreadsheets/d/${this.sheetId}`;\n      }\n      const dataSource = this.extensionManager.getActiveDataSource()[0];\n      await dataSource.retrieve.series.metadata({ StudyInstanceUID, buckets });\n      const studies = [DicomMetadataStore.getStudy(StudyInstanceUID)];\n      const activeProtocolId =\n        HangingProtocolService.getActiveProtocol().protocol.id;\n      HangingProtocolService.reset();\n      HangingProtocolService.run(\n        {\n          studies,\n          activeStudy: studies[0],\n          displaySets: DisplaySetService.getActiveDisplaySets().filter(\n            (ele) => {\n              return ele.StudyInstanceUID === StudyInstanceUID;\n            }\n          ),\n        },\n        activeProtocolId\n      );\n      const segmentations = SegmentationService.getSegmentations();\n      segmentations.forEach((segmentation) =>\n        SegmentationService.remove(segmentation.id)\n      );\n\n      const nextParams = new URLSearchParams(window.location.search);\n      if (nextParams.get('StudyInstanceUIDs'))\n        nextParams.set('StudyInstanceUIDs', StudyInstanceUID);\n      else {\n        nextParams.set('StudyInstanceUID', StudyInstanceUID);\n      }\n      nextParams.delete('bucket');\n      buckets.forEach((bucket) => {\n        nextParams.append('bucket', bucket);\n      });\n\n      const nextURL =\n        window.location.href.split('?')[0] + '?' + nextParams.toString();\n      window.history.replaceState({}, null, nextURL);\n      this.setFormByStudyInstanceUID(StudyInstanceUID);\n      CacheAPIService.setViewedStudy(StudyInstanceUID);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  destroy() {\n    this.sheetId = null;\n    this.index = null;\n    this.sheetName = null;\n    this.formTemplate = null;\n    this.formValue = null;\n    this._broadcastEvent(EVENTS.GOOGLE_SHEETS_ERROR);\n  }\n}\n\nfunction loadSegFiles(serviceManager) {\n  const params = new URLSearchParams(window.location.search);\n  const studyInstanceUID = getStudyInstanceUIDFromParams(params);\n\n  const segSOPClassUIDs = ['1.2.840.10008.5.1.4.1.1.66.4'];\n  const {\n    segmentationService,\n    displaySetService,\n    UserAuthenticationService,\n    CacheAPIService,\n    viewportGridService\n  } = serviceManager.services;\n  const headers = UserAuthenticationService.getAuthorizationHeader();\n\n  const activeStudySegDisplaySets = displaySetService.getDisplaySetsBy(\n    (ds) =>\n      ds.StudyInstanceUID === studyInstanceUID &&\n      segSOPClassUIDs.includes(ds.SOPClassUID)\n  );\n  const nonSegImageIds = displaySetService\n    .getDisplaySetsBy(\n      (ds) =>\n        ds.StudyInstanceUID === studyInstanceUID &&\n        !segSOPClassUIDs.includes(ds.SOPClassUID)\n    )\n    .flatMap((ds) => ds.images.flatMap((image) => image.imageId));\n\n  const isAllSegmentationsLoaded = isAllSegmentationsOfSeriesLoaded(\n    activeStudySegDisplaySets,\n    serviceManager\n  );\n\n  if (isAllSegmentationsLoaded) {\n    const renderedToolGroupIds = [];\n\n    activeStudySegDisplaySets.forEach((ds) => {\n      const toolGroupIds = segmentationService.getToolGroupIdsWithSegmentation(\n        ds.displaySetInstanceUID\n      );\n      toolGroupIds.forEach((toolGroupId) => {\n        if (renderedToolGroupIds.includes(toolGroupId)) {\n          return;\n        }\n\n        csToolsUtils.segmentation.triggerSegmentationRender(toolGroupId);\n        renderedToolGroupIds.push(toolGroupId);\n      });\n    });\n\n    return;\n  }\n\n  const isAllSeriesOfStudyCached = () => {\n    return nonSegImageIds.every((imageId) => cache.getImageLoadObject(imageId));\n  };\n\n  let unsubscribe;\n\n  const loadSegmentations = async () => {\n    if (isAllSeriesOfStudyCached()) {\n      const loadPromises = activeStudySegDisplaySets.map(async (displaySet) => {\n        displaySet.getReferenceDisplaySet();\n        return displaySet.load({ headers });\n      });\n\n      await Promise.all(loadPromises);\n\n      const addRepresentationPromises = activeStudySegDisplaySets.map(\n        async (displaySet) =>\n          await segmentationService.addSegmentationRepresentationToToolGroup(\n            'default',\n            displaySet.displaySetInstanceUID,\n            true\n          )\n      );\n\n      Promise.all(addRepresentationPromises).then(() => {\n        const { viewports, activeViewportId } = viewportGridService.getState();\n        const activeViewport = viewports.get(activeViewportId);\n        const segmentationsOfLoadedImage = displaySetService.getDisplaySetsBy(\n          (ds) =>\n            ds.referencedDisplaySetInstanceUID ===\n            activeViewport.displaySetInstanceUIDs[0]\n        );\n\n        // we are setting first segmentation of the image in the active viewport as active.\n        segmentationService.setActiveSegmentationForToolGroup(\n          segmentationsOfLoadedImage[0].displaySetInstanceUID\n        );\n      });\n      \n      unsubscribe?.();\n    }\n  };\n\n  if (isAllSeriesOfStudyCached()) {\n    loadSegmentations();\n  } else {\n    ({ unsubscribe } = CacheAPIService.subscribe(\n      CacheAPIService.EVENTS.IMAGE_CACHE_PREFETCHED,\n      loadSegmentations\n    ));\n  }\n}\n\nfunction isAllSegmentationsOfSeriesLoaded(\n  activeStudySegDisplaySets,\n  servicesManager\n) {\n  const { segmentationService } = servicesManager.services;\n\n  return activeStudySegDisplaySets.every((ds) =>\n    segmentationService.getSegmentation(ds.displaySetInstanceUID)\n  );\n}\n\nfunction getStudyInstanceUIDFromParams(params) {\n  // Breast OHIF dicomweb datasource uses StudyInstanceUIDs, but bq datasource uses StudyInstanceUID\n  return params.get('StudyInstanceUIDs') || params.get('StudyInstanceUID');\n}\n","export const getSegDisplaysetsOfReferencedImagesIds = (\n  imageIds: string[] = [],\n  displaySetService: any\n) => {\n  const loadedDisplaySet = displaySetService.getDisplaySetsBy((ds) =>\n    ds.images?.find((image) => imageIds.includes(image.imageId))\n  )?.[0];\n\n  const referencedSeriesInstanceUID = loadedDisplaySet.SeriesInstanceUID;\n  return displaySetService.getDisplaySetsBy(\n    (ds) => ds.referencedSeriesInstanceUID === referencedSeriesInstanceUID\n  );\n};\n","import { pubSubServiceInterface } from '@ohif/core';\nimport { \n    EVENTS as CS_EVENTS,\n    eventTarget as CornerstoneEventTarget,\n    getEnabledElement,\n    cache,\n    Enums as CSCORE_ENUMS\n} from '@cornerstonejs/core';\nimport { Enums as CSTOOLS_ENUMS } from '@cornerstonejs/tools';\n\nimport * as tf from '@tensorflow/tfjs';\nimport {\n  IStackViewport,\n  IVolumeViewport,\n} from '@cornerstonejs/core/dist/esm/types';\nimport { getSegDisplaysetsOfReferencedImagesIds } from '../utils';\n\nconst EVENTS = {\n    CROP_DISPLAY_AREA_INIT: 'event::gradienthealth::CropDisplayAreaService:init',\n};\n\nexport default class CropDisplayAreaService {\n    private serviceManager;\n    private listeners;\n    public EVENTS;\n\n    constructor(serviceManager) {\n        this.serviceManager = serviceManager;\n        this.listeners = {};\n        this.EVENTS = EVENTS;\n        window.tf = tf;\n        Object.assign(this, pubSubServiceInterface);\n    }\n\n    init(){\n      CornerstoneEventTarget.addEventListener(CS_EVENTS.STACK_VIEWPORT_NEW_STACK, (evt)=>{\n        const { HangingProtocolService } = this.serviceManager.services\n        if(HangingProtocolService.protocol.id === 'breast') this.handleBreastDensityHP(evt)\n      })\n    }\n\n    private handleBreastDensityHP(evt){\n      const { HangingProtocolService, cornerstoneViewportService } =\n        this.serviceManager.services;\n      const { element, viewportId } = evt.detail;\n      const enabledElement = getEnabledElement(element);\n      const viewport = enabledElement?.viewport;\n      if (!viewport) return;\n\n      const { voiRange, invert } = (viewport as IStackViewport).getProperties();\n      let cutoff;\n      if (voiRange?.lower && !invert) {\n        cutoff = voiRange?.lower;\n      }\n      if (voiRange?.upper && invert) {\n        cutoff = voiRange?.upper;\n      }\n      if (!cutoff) {\n        return;\n      }\n\n      const viewportInfo =\n        cornerstoneViewportService.getViewportInfo(viewportId);\n      const matchedDisplaySets = Array.from(\n        HangingProtocolService.displaySetMatchDetails.values()\n      );\n      const matchedDisplaySetIndex = matchedDisplaySets.findIndex(\n        (displayset) =>\n          displayset.displaySetInstanceUID ===\n          viewportInfo.viewportData.data.displaySetInstanceUID\n      );\n\n      const matchedDisplaySetKeys = Array.from(\n        HangingProtocolService.displaySetMatchDetails.keys()\n      );\n      const matchedDisplaySet = matchedDisplaySetKeys[matchedDisplaySetIndex];\n      if (!matchedDisplaySet) return;\n\n      const imageData = viewport.getImageData();\n      const scalarData = imageData?.scalarData;\n      const dimensions = imageData?.dimensions;\n      if (!scalarData || !dimensions) return;\n\n      // probably will need to account for\n      // imageData.direction\n      // interesting that dim[1], dim[0] are reversed for vtk.js => tf.js\n      // assume this direction does not change\n      const { bboxWidth, bboxHeight, width, height } = tf.tidy(() => {\n        const tensor = tf.tensor2d(new Float32Array(scalarData), [\n          dimensions[1],\n          dimensions[0],\n        ]);\n        const mask = tensor.greater(cutoff); // get boolean\n        const widthBool = mask.any(0); // height?\n        const heightBool = mask.any(1); // width?\n\n        // get bbox\n        const left = widthBool.argMax();\n        const right = widthBool.reverse().argMax().mul(-1).add(widthBool.size);\n        const top = heightBool.argMax();\n        const bottom = heightBool\n          .reverse()\n          .argMax()\n          .mul(-1)\n          .add(heightBool.size);\n\n        // get percentage difference in width and height\n        const bboxWidth = right.sub(left).dataSync()[0];\n        const bboxHeight = bottom.sub(top).dataSync()[0];\n        const width = widthBool.size;\n        const height = heightBool.size;\n\n        return {\n          bboxWidth,\n          bboxHeight,\n          width,\n          height,\n        };\n      });\n\n      const bboxAspectRatio = bboxWidth / bboxHeight;\n      const canvasAspectRatio = viewport.sWidth / viewport.sHeight;\n      // console.log({bboxAspectRatio, canvasAspectRatio})\n      // if(bboxAspectRatio > canvasAspectRatio){\n      //   bboxWidth = canvasAspectRatio*bboxHeight\n      //   bboxAspectRatio = bboxWidth/bboxHeight\n      //   console.log('changed', {bboxAspectRatio, canvasAspectRatio})\n      // }\n\n      const bboxWidthPercentage = bboxWidth / width; // add buffer\n      const bboxHeightPercentage = bboxHeight / height;\n\n      // TODO do not hard code, pick the max between bboxwidth and aspect ratio height\n      const areaZoom = bboxWidthPercentage;\n      //const panAmount = (1 - areaZoom) / 2;\n\n      if (matchedDisplaySet === 'LMLO') {\n        viewport.setDisplayArea(\n          {\n            imageArea: [areaZoom, areaZoom],\n            imageCanvasPoint: {\n              canvasPoint: [0, 0.5],\n              imagePoint: [0, 0.5],\n            },\n            storeAsInitialCamera: true,\n          },\n          true\n        );\n      }\n      if (matchedDisplaySet === 'RMLO') {\n        viewport.setDisplayArea(\n          {\n            imageArea: [areaZoom, areaZoom],\n            imageCanvasPoint: {\n              canvasPoint: [1, 0.5],\n              imagePoint: [1, 0.5],\n            },\n            storeAsInitialCamera: true,\n          },\n\n          true\n        );\n      }\n      if (matchedDisplaySet === 'LCC') {\n        viewport.setDisplayArea(\n          {\n            imageArea: [areaZoom, areaZoom],\n            imageCanvasPoint: {\n              canvasPoint: [0, 0.5],\n              imagePoint: [0, 0.5],\n            },\n            storeAsInitialCamera: true,\n          },\n          true\n        );\n      }\n      if (matchedDisplaySet === 'RCC') {\n        viewport.setDisplayArea(\n          {\n            imageArea: [areaZoom, areaZoom],\n            imageCanvasPoint: {\n              canvasPoint: [1, 0.5],\n              imagePoint: [1, 0.5],\n            },\n            storeAsInitialCamera: true,\n          },\n          true\n          );\n        }\n    }\n\n    destroy() {\n    }\n\n  public async focusToSegment(segmentationId, segmentIndex) {\n    const {\n      segmentationService,\n      viewportGridService,\n      cornerstoneViewportService,\n      displaySetService,\n    } = this.serviceManager.services;\n\n    const segmentation = segmentationService.getSegmentation(segmentationId);\n    const segDisplayset = displaySetService.getDisplaySetByUID(segmentation.displaySetInstanceUID);\n    if (segDisplayset.Modality !== 'SEG') {\n      return;\n    }\n\n    const imageIdReferenceMap =\n      segmentation?.representationData[segmentation.type].imageIdReferenceMap;\n\n    segmentIndex = segmentIndex || segmentation.activeSegmentIndex;\n\n    let dimensions, pixelData;\n\n    if (imageIdReferenceMap) {\n      const image = cache.getImage(imageIdReferenceMap.values().next().value);\n      const { rows, columns } = image;\n      dimensions = [columns, rows, imageIdReferenceMap.size];\n      pixelData = image.getPixelData();\n    } else {\n      const volume = cache.getVolume(segmentationId);\n      ({ dimensions } = volume);\n      pixelData = volume.scalarData;\n    }\n\n    const mask = tf.tidy(() => {\n      let tensor;\n      if (imageIdReferenceMap) {\n        tensor = tf.tensor2d(new Float32Array(pixelData), [\n          dimensions[1],\n          dimensions[0],\n        ]);\n      } else {\n        tensor = tf.tensor3d(new Float32Array(pixelData), [\n          dimensions[2],\n          dimensions[0],\n          dimensions[1],\n        ]);\n      }\n\n      return tensor.equal(segmentIndex); // get boolean\n    });\n\n    const maskCoordinates = await tf.whereAsync(mask);\n\n    const { xMax, yMax, xMin, yMin } = tf.tidy(() => {\n      const transpose = tf.einsum('ij->ji', maskCoordinates);\n      tf.dispose(mask);\n      tf.dispose(maskCoordinates);\n\n      let xMin = 0,\n        xMax = dimensions[0],\n        yMin = 0,\n        yMax = dimensions[1];\n\n      if (transpose.size !== 0) {\n        if (imageIdReferenceMap) {\n          xMin = transpose.gather(1).min().dataSync()[0];\n          xMax = transpose.gather(1).max().dataSync()[0];\n          yMin = transpose.gather(0).min().dataSync()[0];\n          yMax = transpose.gather(0).max().dataSync()[0];\n        } else {\n          xMin = transpose.gather(2).min().dataSync()[0];\n          xMax = transpose.gather(2).max().dataSync()[0];\n          yMin = transpose.gather(1).min().dataSync()[0];\n          yMax = transpose.gather(1).max().dataSync()[0];\n        }\n      }\n\n      return { xMax, yMax, xMin, yMin };\n    });\n\n    const referencedDisplaySetInstanceUID = segDisplayset.referencedDisplaySetInstanceUID;\n    const { viewports, activeViewportId } = viewportGridService.getState();\n    const viewportsWithSegmentation: IStackViewport | IVolumeViewport = [];\n    viewports.forEach((viewport) => {\n      if (viewport.displaySetInstanceUIDs.includes(referencedDisplaySetInstanceUID)) {\n        viewportsWithSegmentation.push(\n          cornerstoneViewportService.getCornerstoneViewport(viewport.viewportId)\n        );\n      }\n    });\n\n    let bboxWidth = xMax + 1 - xMin;\n    let bboxHeight = yMax + 1 - yMin;\n    let width = dimensions[0];\n    let height = dimensions[1];\n    const imageAspectRatio = width / height;\n\n    const imagePoint = [\n      (xMax + xMin) / (2 * width),\n      (yMax + yMin) / (2 * height),\n    ] as [number, number];\n    const zoomFactors = {\n      x: bboxWidth / width,\n      y: bboxHeight / height,\n    };\n\n    viewportsWithSegmentation.forEach((viewport) => {\n      const canvasAspectRatio = viewport.sWidth / viewport.sHeight;\n      const zoomFactorsCopy = { ...zoomFactors };\n      correctZoomFactors(zoomFactorsCopy, imageAspectRatio, canvasAspectRatio);\n\n      setDisplayArea(viewport, zoomFactorsCopy, imagePoint);\n    });\n\n    if (!viewportsWithSegmentation.length) {\n      const activeViewport =\n        cornerstoneViewportService.getCornerstoneViewport(activeViewportId);\n\n      handleFocusingForNewStack(\n        activeViewport,\n        displaySetService,\n        zoomFactors,\n        imagePoint,\n        imageAspectRatio\n      );\n    }\n  }\n}\n\nconst setDisplayArea = (\n  viewport: IStackViewport | IVolumeViewport,\n  zoomFactors: { x: number; y: number },\n  imagePoint: [number, number]\n) => {\n  viewport.setDisplayArea({\n    imageArea: <[number, number]>[zoomFactors.x, zoomFactors.y],\n    imageCanvasPoint: { imagePoint, canvasPoint: <[number, number]>[0.5, 0.5] },\n  });\n  viewport.render();\n};\n\nconst handleFocusingForNewStack = (\n  viewport: IStackViewport | IVolumeViewport,\n  displaySetService: any,\n  zoomFactors: { x: number; y: number },\n  imagePoint: [number, number],\n  imageAspectRatio: number\n) => {\n  const canvasAspectRatio = viewport.sWidth / viewport.sHeight;\n\n  const eventElement =\n    viewport.type === CSCORE_ENUMS.ViewportType.STACK\n      ? CornerstoneEventTarget\n      : viewport.element;\n  const eventName =\n    viewport.type === CSCORE_ENUMS.ViewportType.STACK\n      ? CS_EVENTS.STACK_VIEWPORT_NEW_STACK\n      : CS_EVENTS.VOLUME_VIEWPORT_NEW_VOLUME;\n\n  const newImageListener = (evt) => {\n    const segDisplaySetsOfLoadedSeries = getSegDisplaysetsOfReferencedImagesIds(\n      evt.detail.imageIds,\n      displaySetService\n    );\n\n    let segmentationsRenderedCount = 0;\n    const segmentationRenderedListener = () => {\n      if (\n        ++segmentationsRenderedCount === segDisplaySetsOfLoadedSeries.length\n      ) {\n        correctZoomFactors(zoomFactors, imageAspectRatio, canvasAspectRatio);\n        setDisplayArea(viewport, zoomFactors, imagePoint);\n\n        CornerstoneEventTarget.removeEventListener(\n          CSTOOLS_ENUMS.Events.SEGMENTATION_RENDERED,\n          segmentationRenderedListener\n        );\n      }\n    };\n\n    CornerstoneEventTarget.addEventListener(\n      CSTOOLS_ENUMS.Events.SEGMENTATION_RENDERED,\n      segmentationRenderedListener\n    );\n\n    eventElement.removeEventListener(eventName, newImageListener);\n  };\n\n  eventElement.addEventListener(eventName, newImageListener);\n};\n\nconst correctZoomFactors = (\n  zoomFactors: { x: number; y: number },\n  imageAspectRatio: number,\n  canvasAspectRatio: number\n) => {\n  if (imageAspectRatio < canvasAspectRatio) {\n    zoomFactors.x /= canvasAspectRatio / imageAspectRatio;\n  }\n  if (imageAspectRatio > canvasAspectRatio) {\n    zoomFactors.y /= imageAspectRatio / canvasAspectRatio;\n  }\n\n  if (zoomFactors.x > 0.8 || zoomFactors.y > 0.8) {\n    return;\n  }\n\n  const zoomOutPercentatage = 80;\n\n  zoomFactors.x /= zoomOutPercentatage / 100;\n  zoomFactors.y /= zoomOutPercentatage / 100;\n};","import { DicomMetadataStore, pubSubServiceInterface } from '@ohif/core';\nimport { internal, wadouri } from '@cornerstonejs/dicom-image-loader';\nconst { getOptions } = internal;\nimport _ from 'lodash';\nimport {\n  eventTarget,\n  EVENTS,\n  Enums,\n  imageLoader,\n  imageLoadPoolManager,\n} from '@cornerstonejs/core';\n\nconst LOCAL_EVENTS = {\n  IMAGE_CACHE_PREFETCHED: 'event::gradienthealth::image_cache_prefetched',\n};\n\nexport default class CacheAPIService {\n  listeners: { [key: string]: Function[] };\n  EVENTS: { [key: string]: string };\n  element: HTMLElement;\n  private servicesManager;\n  private commandsManager;\n  private extensionManager;\n  private dataSource;\n  private options;\n  public storageUsage;\n  public storageQuota;\n  private imageIdToFileUriMap;\n\n  constructor(servicesManager, commandsManager, extensionManager) {\n    this.listeners = {};\n    this.EVENTS = LOCAL_EVENTS;\n    this.commandsManager = commandsManager;\n    this.extensionManager = extensionManager;\n    this.servicesManager = servicesManager;\n    this.storageUsage = null;\n    this.storageQuota = null;\n    this.imageIdToFileUriMap = new Map();\n    Object.assign(this, pubSubServiceInterface);\n  }\n\n  public init() {\n    // Need to add event listener if datasource changes\n    const dataSources = this.extensionManager.getActiveDataSource();\n    this.dataSource = dataSources[0];\n\n    eventTarget.addEventListener(\n      'CORNERSTONE_CACHE_QUOTA_EXCEEDED_ERROR',\n      this.handleQuotaExceededWriteError.bind(this)\n    );\n\n    if (window?.navigator?.storage?.estimate) {\n      window?.navigator?.storage?.estimate().then((estimate) => {\n        console.log(\n          'Storage use: ',\n          estimate.usage * 1e-9,\n          ' of ',\n          estimate.quota * 1e-9,\n          ' GB'\n        );\n        this.storageUsage = estimate.usage;\n        this.storageQuota = estimate.quota;\n      });\n    }\n\n    if (\n      window?.navigator?.storage?.persisted &&\n      window?.navigator?.storage?.persist\n    ) {\n      window?.navigator?.storage?.persisted().then((persistent) => {\n        if (!persistent) {\n          window?.navigator?.storage?.persist().then((persistent) => {\n            if (persistent) {\n              console.log(\n                'Storage will not be cleared except by explicit user action'\n              );\n            } else {\n              console.log(\n                'Storage may be cleared by the UA under storage pressure.'\n              );\n            }\n          });\n        } else {\n          console.log(\n            'Storage will not be cleared except by explicit user action'\n          );\n        }\n      });\n    }\n  }\n\n  public async setViewedStudy(StudyInstanceUID) {\n    await this.dataSource.retrieve.series.metadata({ StudyInstanceUID });\n    const study = DicomMetadataStore.getStudy(StudyInstanceUID);\n    const imageIds = study.series.flatMap((serie) =>\n      serie.instances.flatMap((instance) => instance.imageId)\n    );\n    const urls = imageIds.map((imageId) =>\n      imageId.split(':').slice(1).join(':')\n    );\n    const options = getOptions();\n    const getScope = options.cache.getScope;\n    const scopes = _.uniq(urls.map((url) => getScope({ url })));\n    scopes.forEach(async (scope) => {\n      const cache = await caches.open(scope);\n      const keys = await cache.keys();\n      keys.forEach(async (key) => {\n        const res = await cache.match(key.url, {\n          ignoreVary: true,\n          ignoreMethod: true,\n          ignoreSearch: true,\n        });\n        if(!res) return\n        const req = new Request(key.url, {\n          headers: {\n            'dicom-last-put-date': new Date().toUTCString(),\n            'dicom-last-viewed-date': new Date().toUTCString(),\n            'dicom-content-length': key.headers.get('dicom-content-length')\n          },\n        });\n        if (res) {\n          cache.put(req, res);\n        }\n      });\n    });\n  }\n\n  public async cacheStudy(StudyInstanceUID, buckets = undefined) {\n    const segSOPClassUIDs = ['1.2.840.10008.5.1.4.1.1.66.4'];\n    await this.dataSource.retrieve.series.metadata({\n      StudyInstanceUID,\n      buckets,\n    });\n    const study = DicomMetadataStore.getStudy(StudyInstanceUID);\n    const imageIds = study.series\n      .filter(\n        (serie) => !segSOPClassUIDs.includes(serie.instances[0].SOPClassUID)\n      )\n      .flatMap((serie) =>\n        serie.instances.flatMap((instance) => instance.imageId)\n      );\n    await Promise.all([\n      this.cacheImageIds(imageIds),\n      this.cacheSegFiles(StudyInstanceUID),\n    ]);\n  }\n\n  public async cacheSeries(StudyInstanceUID, SeriesInstanceUID) {\n    await this.dataSource.retrieve.series.metadata({ StudyInstanceUID });\n    const study = DicomMetadataStore.getStudy(StudyInstanceUID);\n    const imageIds = study.series\n      .filter((serie) => serie.SeriesInstanceUID === SeriesInstanceUID)\n      .flatMap((serie) =>\n        serie.instances.flatMap((instance) => instance.imageId)\n      );\n    this.cacheImageIds(imageIds);\n  }\n\n  public async cacheImageIds(imageIds) {\n    const promises: any[] = [];\n    \n    function sendRequest(imageId, options) {\n      const promise = imageLoader.loadAndCacheImage(imageId, options);\n      promises.push(promise);\n\n      return promise.then(\n        (imageLoadObject) => {\n          this._broadcastEvent(this.EVENTS.IMAGE_CACHE_PREFETCHED, { imageLoadObject });\n        },\n        (error) => {\n          console.error(error);\n        }\n      );\n    }\n\n    const priority = 0;\n    const requestType = Enums.RequestType.Prefetch;\n    const options = {\n      preScale: {\n        enabled: true,\n      },\n      useRGBA: true,\n    };\n\n    imageIds.forEach((imageId) => {\n      const additionalDetails = { imageId };\n      imageLoadPoolManager.addRequest(\n        sendRequest.bind(this, imageId, options),\n        requestType,\n        additionalDetails,\n        priority\n      );\n    });\n\n    await Promise.all(promises)\n  }\n\n  public async cacheSegFiles(studyInstanceUID) {\n    const segSOPClassUIDs = ['1.2.840.10008.5.1.4.1.1.66.4'];\n    const { displaySetService, userAuthenticationService } =\n      this.servicesManager.services;\n\n    const study = DicomMetadataStore.getStudy(studyInstanceUID);\n    const headers = userAuthenticationService.getAuthorizationHeader();\n    const promises = study.series.map((serie) => {\n      const { SOPClassUID, SeriesInstanceUID, url } = serie.instances[0];\n      if (segSOPClassUIDs.includes(SOPClassUID)) {\n        const { scheme, url: parsedUrl } = wadouri.parseImageId(url);\n        if (scheme === 'dicomzip') {\n          return wadouri.loadZipRequest(parsedUrl, url);\n        }\n\n        const displaySet =\n          displaySetService.getDisplaySetsForSeries(SeriesInstanceUID)[0];\n\n        if (this.imageIdToFileUriMap.get(url) === displaySet.instance.imageId) {\n          return;\n        }\n\n        return fetch(parsedUrl, { headers })\n          .then((response) => response.arrayBuffer())\n          .then((buffer) => wadouri.fileManager.add(new Blob([buffer])))\n          .then((fileUri) => {\n            this.imageIdToFileUriMap.set(url, fileUri);\n            displaySet.instance.imageId = fileUri;\n            displaySet.instance.getImageId = () => fileUri;\n          });\n      }\n    });\n\n    await Promise.all(promises);\n  }\n\n  public updateCachedFile(blob, displaySet) {\n    const { url, imageId } = displaySet.instances[0];\n    const fileUri = wadouri.fileManager.add(blob);\n    displaySet.instance.imageId = fileUri;\n    displaySet.instance.getImageId = () => fileUri;\n    this.imageIdToFileUriMap.set(url, fileUri);\n\n    if (imageId?.startsWith('dicomfile:')) {\n      const { url: index } = wadouri.parseImageId(imageId);\n      wadouri.fileManager.remove(index);\n    }\n  }\n\n  public async cacheMissingStudyImageIds(StudyInstanceUIDs) {\n    const existingKeys = await window.caches.keys();\n    const existingStudyInstanceUIDs = existingKeys.map(\n      (key) => key.split('studies/')[1].split('/')[0]\n    );\n    const newStudies = StudyInstanceUIDs.filter(\n      (studyuid) => existingStudyInstanceUIDs.indexOf(studyuid) === -1\n    );\n    newStudies.forEach((studyuid) => {\n      this.cacheStudy(studyuid);\n    });\n  }\n\n  /**\n   * Removes all cached images which have been seen.\n   * @param evt\n   * @returns\n   */\n  private async handleQuotaExceededWriteError(evt) {\n    const scopes = await window.caches.keys();\n    scopes.forEach(async (scope) => {\n      try {\n        const cache = await caches.open(scope);\n        const k = await cache.keys();\n        const lastViewed = k[0].headers.get('dicom-last-viewed-date');\n        const utctime = k[0].headers.get('dicom-last-put-date');\n        const date = utctime ? new Date(utctime) : new Date();\n        const timeNow = new Date();\n        const timeSincePut = timeNow - date;\n        const millisecondsInDay = 8.64e7;\n        if (lastViewed !== 'undefined' || timeSincePut > 7 * millisecondsInDay) {\n          window.caches.delete(scope);\n        }\n      } catch (err) {\n        console.error(err);\n      }\n    });\n  }\n\n  public destroy() {\n    eventTarget.removeEventListener(\n      'CORNERSTONE_CACHE_QUOTA_EXCEEDED_ERROR',\n      this.handleQuotaExceededWriteError\n    );\n  }\n}\n","const addSegmentationLabelModifier = (servicesManager) => {\n  const { segmentationService, displaySetService } = servicesManager.services;\n\n  segmentationService.subscribe(\n    segmentationService.EVENTS.SEGMENTATION_ADDED,\n    ({ segmentation }) => {\n      let displaySet = displaySetService.getDisplaySetByUID(\n        segmentation.displaySetInstanceUID\n      );\n\n      if (displaySet.Modality === 'SEG') {\n        return;\n      }\n\n      const descriptionComponents = [\n        displaySet.instances[0].ImageLaterality,\n        displaySet.instances[0].ViewPosition,\n        displaySet.SeriesDescription?.replace(/[/]/, ''),\n      ];\n      const newDescription = descriptionComponents\n        .filter((variable) => variable !== undefined)\n        .join('-');\n\n      const segmentationsCount =\n        segmentationService.getSegmentations(false).length;\n      const increment = segmentationsCount > 0 ? ' ' + segmentationsCount : '';\n\n      const label = `${newDescription} - Vessel ${increment}`;\n      segmentation.label = label;\n\n      segmentationService.addOrUpdateSegmentation(\n        segmentation,\n        false, // suppress event\n        true // notYetUpdatedAtSource\n      );\n    }\n  );\n};\n\nexport default addSegmentationLabelModifier;\n","import getPanelModule from './getPanelModule';\nimport getViewportModule from './getViewportModule';\nimport getHangingProtocolModule from './getHangingProtocolModule';\nimport getDataSourcesModule from './getDataSourcesModule';\n\nimport { id } from './id.js';\nimport GoogleSheetsService from './services/GoogleSheetsService';\nimport CropDisplayAreaService from './services/CropDisplayAreaService';\nimport CacheAPIService from './services/CacheAPIService';\nimport addSegmentationLabelModifier from './utils/addSegmentationLabelModifier';\n\n// import { CornerstoneEventTarget } from '@cornerstonejs/core/CornerstoneEventTarget';\n// import { Events } from '@cornerstonejs/core/Events';\n\nconst gradientHealthExtension = {\n  /**\n   * Only required property. Should be a unique value across all extensions.\n   */\n  id,\n  onModeEnter({ servicesManager}){\n    addSegmentationLabelModifier(servicesManager)\n  },\n  getDataSourcesModule: ({ servicesManager }) => {\n    return getDataSourcesModule({ servicesManager });\n  },\n  getHangingProtocolModule,\n  getPanelModule,\n  getViewportModule,\n  preRegistration({ servicesManager, commandsManager, extensionManager}) {\n    servicesManager.registerService(GoogleSheetsService(servicesManager, commandsManager, extensionManager));\n    servicesManager.registerService(CropDisplayAreaService(servicesManager));\n    servicesManager.registerService(CacheAPIService(servicesManager, commandsManager, extensionManager));\n\n    const { HangingProtocolService } = servicesManager.services;\n    HangingProtocolService.addCustomAttribute('ViewCodeSequence', 'ViewCodeSequence', metaData => {\n        const viewCodeSeq = metaData[\"ViewCodeSequence\"] ??\n        ((metaData.images || metaData.others || [])[0] || {})[\n          \"ViewCodeSequence\"\n        ];\n        return viewCodeSeq[0].CodeValue\n      }\n    );\n  },\n};\n\nexport default gradientHealthExtension;\n","import CropDisplayAreaService from './CropDisplayAreaService';\n\nexport default function CropDisplayAreaServiceWithServices(serviceManager) {\n  return {\n    name: 'CropDisplayAreaService',\n    create: ({ configuration = {} }) => {\n      return new CropDisplayAreaService(serviceManager);\n    },\n  }\n};\n","import GoogleSheetsService from './GoogleSheetsService.js';\n\nexport default function GoogleSheetsServiceWithServices(serviceManager, commandsManager, extensionManager) {\n  return {\n    name: 'GoogleSheetsService',\n    create: ({ configuration = {} }) => {\n      return new GoogleSheetsService(serviceManager, commandsManager, extensionManager);\n    },\n  }\n};\n","import CacheAPIService from './CacheAPIService';\n\nexport default function ExtendedCacheAPIService(servicesManager, commandsManager, extensionManager) {\n  return {\n    name: 'CacheAPIService',\n    create: ({ configuration = {} }) => {\n      return new CacheAPIService(servicesManager, commandsManager, extensionManager);\n    },\n  };\n}\n"],"names":["formatDate","utils","PanelStudyBrowserTracking","MeasurementService","DisplaySetService","UIDialogService","UINotificationService","getImageSrc","getStudiesForPatientByMRN","requestDisplaySetCreationForStudy","dataSource","StudyInstanceUIDs","useImageViewer","activeViewportId","viewports","numCols","numRows","viewportGridService","useViewportGrid","navigate","useNavigate","activeTabName","setActiveTabName","useState","expandedStudyInstanceUIDs","setExpandedStudyInstanceUIDs","studyDisplayList","setStudyDisplayList","displaySets","setDisplaySets","thumbnailImageSrcMap","setThumbnailImageSrcMap","jumpToDisplaySet","setJumpToDisplaySet","activeViewportDisplaySetInstanceUIDs","get","displaySetInstanceUIDs","isSingleViewport","useEffect","added","EVENTS","MEASUREMENT_ADDED","addedRaw","RAW_MEASUREMENT_ADDED","subscriptions","forEach","evt","push","subscribe","source","measurement","referenceSeriesUID","SeriesInstanceUID","referenceStudyUID","StudyInstanceUID","unsubscribe","unsub","sid","async","qidoForStudyUID","query","studies","search","studyInstanceUid","length","Error","qidoStudiesForPatient","error","console","warn","actuallyMappedStudies","map","study","AccessionNumber","accession","StudyDate","date","StudyDescription","description","NumInstances","instances","ModalitiesInStudy","modalities","PatientID","mrn","PatientName","patientName","StudyTime","time","qidoStudy","numInstances","prevArray","ret","find","it","fetchStudiesForPatient","activeDisplaySets","newImageSrcEntry","displaySet","getDisplaySetByUID","dSet","displaySetInstanceUID","imageIds","getImageIdsForDisplaySet","imageId","Math","floor","prevState","mappedDisplaySets","_mapDisplaySets","SubscriptionDisplaySetsAdded","DISPLAY_SETS_ADDED","data","displaySetsAdded","options","madeInClient","SubscriptionDisplaySetsChanged","DISPLAY_SETS_CHANGED","changedDisplaySets","tabs","primaryStudyInstanceUIDs","primaryStudies","recentStudies","allStudies","displaySetsForStudy","filter","ds","tabStudy","sortBySeriesDate","Object","assign","includes","_byDate","a","b","dateA","Date","parse","name","label","sort","studyA","studyB","_createStudyBrowserTabs","element","document","getElementById","scrollIntoView","behavior","thumbnailLocation","t","s","d","tabName","_findTabAndStudyOfDisplaySet","updatedExpandedStudyInstanceUIDs","React","StudyBrowser","onClickStudy","shouldCollapseStudy","stdyUid","onClickTab","clickedTabName","onClickThumbnail","onDoubleClickThumbnail","setDisplaySetsForViewport","viewportId","activeDisplaySetInstanceUIDs","propTypes","PropTypes","isRequired","thumbnailDisplaySets","thumbnailNoImageDisplaySets","imageSrc","componentType","Modality","thumbnailNoImageModalities","_getComponentType","viewportIdentificator","values","reduce","acc","viewportData","index","viewportLabel","array","thumbnailProps","SeriesDescription","seriesNumber","String","SeriesNumber","modality","seriesDate","SeriesDate","numImageFrames","dragData","type","reject","series","canReject","onReject","create","id","centralize","isDraggable","showOverlay","content","Dialog","contentProps","title","body","className","actions","text","classes","onClose","dismiss","onShow","querySelector","focus","onSubmit","action","deleteDisplaySet","show","message","cornerstone","Promise","resolve","canvas","createElement","utilities","loadImageToCanvas","then","toDataURL","catch","some","retrieve","metadata","createGetImageSrcFromImageIdFn","extensionManager","getModuleEntry","exports","getCornerstoneLibraries","getImageSrcFromImageId","bind","ex","getStudyForPatientUtility","datasource","utilityModule","createRequestDisplaySetcreationFn","studyPanelUtilities","WrappedPanelStudyBrowserTracking","commandsManager","servicesManager","getActiveDataSource","_getStudiesForPatientByMRN","_getImageSrcFromImageId","_requestDisplaySetCreationForStudy","services","downloadCSVReport","DISPLAY_STUDY_SUMMARY_INITIAL_VALUE","key","undefined","PanelMeasurementTableTracking","viewportGrid","measurementChangeTimestamp","setMeasurementsUpdated","now","toString","debouncedMeasurementChangeTimestamp","value","delay","debouncedValue","setDebouncedValue","handler","setTimeout","clearTimeout","useDebounce","displayStudySummary","setDisplayStudySummary","displayMeasurements","setDisplayMeasurements","mappedMeasurements","getMeasurements","m","types","SOPInstanceUID","DicomMetadataStore","getInstance","getDisplaySetsForSeries","images","displayText","uid","measurementType","isActive","_mapMeasurementToDisplay","VALUE_TYPES","updated","MEASUREMENT_UPDATED","removed","MEASUREMENT_REMOVED","cleared","MEASUREMENTS_CLEARED","jumpToImage","jumpToMeasurement","onMeasurementItemClickHandler","measurements","onMeasurementDeleteHandler","remove","displayMeasurementsWithoutFindings","dm","POINT","additionalFindings","StudySummary","MeasurementTable","amount","onClick","onEdit","onMeasurementItemEditHandler","getMeasurement","onSubmitHandler","update","noCloseButton","setValue","Input","autoFocus","containerClassName","onChange","event","persist","target","onKeyPress","onDelete","RatingSelector","formIndex","defaultValue","labels","precision","max","getKeyFromValue","v","obj","keys","idx","ele","Number","val","setVal","hover","setHover","Paper","Typography","sx","fontSize","color","gutterBottom","variant","component","Rating","newValue","onChangeActive","newHover","emptyIcon","StarIcon","style","opacity","GridSelector","cols","Boolean","all","one","i","ch","concat","chunk","RadioGroup","row","FormControlLabel","control","Radio","CheckboxLabels","checked","FormGroup","Checkbox","Textarea","rows","debouncedOnChange","useMemo","debounce","TextField","inputProps","multiline","fullWidth","margin","size","DisplayValue","display","marginRight","UserProfile","getDateText","lastUpdated","days","hours","minutes","cd","h","round","toLocaleDateString","year","month","day","JSON","e","CardHeader","overflow","avatar","Avatar","imgProps","crossOrigin","referrerPolicy","src","picture","email","subheader","formTemplate","formValue","setFormValue","onChangeHandler","newFormValue","inputs","template","PanelForm","GoogleSheetsService","setFormTemplate","getFormTemplate","getFormValue","setError","firstLoad","setFirstLoad","initLoading","setInitLoading","loading","setLoading","onNext","getRow","onPrevious","debouncedOnNext","debouncedOnPrevious","GOOGLE_SHEETS_CHANGE","GOOGLE_SHEETS_ERROR","updateRow","LinearProgress","height","FormGeneratorComponent","ButtonGroup","LoadingButton","loadingPosition","startIcon","ArrowBack","endIcon","ArrowForward","PanelFormAndMeasurementTable","overflowY","Divider","background","sortStudyInstances","PanelStudyBrowser","hangingProtocolService","displaySetService","uiNotificationService","studyInstanceUIDs","setStudyInstanceUIDs","unsupported","initialViewport","SubscriptionDisplaySetMetaDataInvalidated","DISPLAY_SET_SERIES_METADATA_INVALIDATED","getActiveDisplaySets","newStudyInstanceUID","entries","studyUIDToIndex","updatedViewports","getViewportsRequireUpdate","duration","setDisplaySetsForViewports","excludeFromThumbnailBrowser","seriesTime","SeriesTime","countIcon","messages","isHydratedForDerivedDisplaySet","isHydrated","WrappedPanelStudyBrowser","getDataSources","useCallback","iconName","iconLabel","Component","OHIFCornerstoneViewport","props","fallback","_extends","disableViewportOrientationMarkers","breastProtocol","locked","hasUpdatedPriorsInformation","createdDate","modifiedDate","availableTo","editableBy","protocolMatchingRules","displaySetSelectors","LMLO","seriesMatchingRules","LCC","RMLO","RCC","toolGroupIds","stages","viewportStructure","properties","columns","viewportOptions","toolGroupId","numberOfPriorsReferenced","protocol","getImageId","instance","frame","config","thumbnail","url","renderingAttr","uri","baseWadoRsUri","wadoRoot","buildInstanceWadoRsUri","buildInstanceFrameWadoRsUri","getWADORSImageId","wadouri","params","paramString","join","wadoUriRoot","buildInstanceWadoUrl","metadataProvider","MetadataProvider","datasetToBlob","dcmjs","mappings","patientId","_store","urls","studyInstanceUIDMap","Map","getMetaDataByURL","metaData","getInstanceUrl","prefix","modifiedUrl","replace","getProperty","serieMetadata","property","getMetadataFromRows","seriesuidArray","filteredRows","_","x","rowsByStudy","studyuid","studyNumInstances","parseInt","isNaN","PatientSex","PatientWeight","PatientAge","Modalities","filesFromStudyInstanceUID","bucketName","studyuids","headers","studyMetadata","apiUrl","response","fetch","res","json","items","prefixes","encodeURIComponent","folderPath","findStudies","aStudy","storeDicomSeg","naturalizedReport","URLSearchParams","window","location","buckets","getAll","bucket","segBucket","segPrefix","filteredDescription","fileName","segDisplaySet","getDisplaySetsBy","split","segUploadUri","blob","compressedFile","pako","arrayBuffer","method","code","segUri","segSeries","dataSet","FrameOfReferenceUID","SOPClassUID","ReferencedSeriesSequence","SharedFunctionalGroupsSequence","PerFrameFunctionalGroupsSequence","SegmentSequence","Manufacturer","stringify","_dicomJsonConfig","createDicomJSONApi","dicomJsonConfig","init","implementation","updateConfig","dicomWebConfig","initialize","set","UserAuthenticationService","metadataPerBucket","getAuthorizationHeader","naturalizedDicom","addImageIdToUIDs","mapParams","param","mappedParam","processResults","debug","directURL","customSort","delete","append","seriesSummaryMetadata","seriesSummary","addSeriesMetadata","numberOfSeries","naturalizedInstances","addInstances","getStudy","isLoaded","store","dicom","dataset","NumberOfFrames","getImageIdsForInstance","getStudyInstanceUIDs","IWebApiDataSource","createDataSource","packageJson","letters","letter_1","letter_2","alphabet","GOOGLE_SHEETS_DESTROY","convertFormValues","constructor","serviceManager","this","listeners","api_key","sheetId","sheetName","settings","formHeader","pubSubServiceInterface","cacheNearbyStudyInstanceUIDs","bufferBack","bufferFront","CacheAPIService","min","urlIndex","findIndex","studyIdIndex","rowsToCache","slice","indexOfCurrentId","splice","unshift","promise","getStudyInstanceUIDFromParams","cacheStudy","setFormByStudyInstanceUID","setFormByIndex","rowValues","readFormValue","_broadcastEvent","user","getUser","pathname","startsWith","eventTarget","addEventListener","Enums","STACK_VIEWPORT_NEW_STACK","studyInstanceUID","segSOPClassUIDs","segmentationService","activeStudySegDisplaySets","nonSegImageIds","flatMap","image","every","getSegmentation","isAllSegmentationsOfSeriesLoaded","renderedToolGroupIds","getToolGroupIdsWithSegmentation","csToolsUtils","isAllSeriesOfStudyCached","cache","getImageLoadObject","loadSegmentations","loadPromises","getReferenceDisplaySet","load","addRepresentationPromises","addSegmentationRepresentationToToolGroup","getState","activeViewport","segmentationsOfLoadedImage","referencedDisplaySetInstanceUID","setActiveSegmentationForToolGroup","IMAGE_CACHE_PREFETCHED","loadSegFiles","readRange","prev","curr","colIndex","header","col","order","baseUrl","Authorization","writeRange","range","xhr","XMLHttpRequest","open","setRequestHeader","onload","status","send","majorDimension","colName","profile","updatedFormValue","delta","HangingProtocolService","SegmentationService","href","activeProtocolId","getActiveProtocol","reset","run","activeStudy","getSegmentations","segmentation","nextParams","nextURL","history","replaceState","setViewedStudy","destroy","CROP_DISPLAY_AREA_INIT","CropDisplayAreaService","tf","CornerstoneEventTarget","CS_EVENTS","handleBreastDensityHP","cornerstoneViewportService","detail","enabledElement","getEnabledElement","viewport","voiRange","invert","getProperties","cutoff","lower","upper","viewportInfo","getViewportInfo","matchedDisplaySetIndex","Array","from","displaySetMatchDetails","displayset","matchedDisplaySet","imageData","getImageData","scalarData","dimensions","bboxWidth","bboxHeight","width","mask","Float32Array","greater","widthBool","any","heightBool","left","argMax","right","reverse","mul","add","top","bottom","sub","dataSync","areaZoom","sWidth","sHeight","setDisplayArea","imageArea","imageCanvasPoint","canvasPoint","imagePoint","storeAsInitialCamera","focusToSegment","segmentationId","segmentIndex","segDisplayset","imageIdReferenceMap","representationData","pixelData","activeSegmentIndex","getImage","next","getPixelData","volume","getVolume","tensor","equal","maskCoordinates","xMax","yMax","xMin","yMin","transpose","gather","viewportsWithSegmentation","getCornerstoneViewport","imageAspectRatio","zoomFactors","y","canvasAspectRatio","zoomFactorsCopy","correctZoomFactors","handleFocusingForNewStack","render","eventElement","CSCORE_ENUMS","STACK","eventName","VOLUME_VIEWPORT_NEW_VOLUME","newImageListener","segDisplaySetsOfLoadedSeries","getSegDisplaysetsOfReferencedImagesIds","loadedDisplaySet","referencedSeriesInstanceUID","segmentationsRenderedCount","segmentationRenderedListener","removeEventListener","CSTOOLS_ENUMS","SEGMENTATION_RENDERED","zoomOutPercentatage","getOptions","internal","LOCAL_EVENTS","storageUsage","storageQuota","imageIdToFileUriMap","dataSources","handleQuotaExceededWriteError","navigator","storage","estimate","log","usage","quota","persisted","persistent","serie","getScope","caches","scope","match","ignoreVary","ignoreMethod","ignoreSearch","req","Request","toUTCString","put","cacheImageIds","cacheSegFiles","cacheSeries","promises","sendRequest","imageLoader","imageLoadObject","requestType","Prefetch","preScale","enabled","useRGBA","additionalDetails","imageLoadPoolManager","addRequest","userAuthenticationService","scheme","parsedUrl","parseImageId","loadZipRequest","buffer","fileManager","Blob","fileUri","updateCachedFile","cacheMissingStudyImageIds","existingStudyInstanceUIDs","indexOf","k","lastViewed","utctime","timeNow","err","SEGMENTATION_ADDED","newDescription","ImageLaterality","ViewPosition","variable","segmentationsCount","addOrUpdateSegmentation","onModeEnter","addSegmentationLabelModifier","getDataSourcesModule","getHangingProtocolModule","getPanelModule","getViewportModule","preRegistration","registerService","configuration","addCustomAttribute","others","CodeValue"],"sourceRoot":""}