"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[451],{4451:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var s=n(3827),a=n.n(s),r=n(43001),i=n(69190),o=n(78695),l=n(98466);const c=function(e,t,n){const{tools:s}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,s,{})};var u=n(28417);const p={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const m=function(e){let{servicesManager:t,segDisplaySet:n,viewportId:s,preHydrateCallbacks:a}=e;const{uiViewportDialogService:r}=t.services;return new Promise((async function(e,i){const o=await function(e,t){return new Promise((function(n,s){const a="Do you want to open this Segmentation?",r=[{type:l.LZ.U.secondary,text:"No",value:p.CANCEL},{type:l.LZ.U.primary,text:"Yes",value:p.HYDRATE_SEG}],i=t=>{e.hide(),n(t)};e.show({viewportId:t,type:"info",message:a,actions:r,onSubmit:i,onOutsideClick:()=>{e.hide(),n(p.CANCEL)}})}))}(r,s);if(o===p.HYDRATE_SEG){a?.forEach((e=>{e()}));e(await(0,u.Z)({segDisplaySet:n,viewportId:s,servicesManager:t}))}}))};function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},d.apply(this,arguments)}const{formatDate:S}=o.utils;function g(e){const{children:t,displaySets:n,viewportOptions:s,viewportLabel:a,servicesManager:p,extensionManager:g,commandsManager:E}=e,{t:v}=(0,i.$G)("SEGViewport"),f=s.viewportId,{displaySetService:y,toolGroupService:w,segmentationService:b,uiNotificationService:h,customizationService:D}=p.services,I=`SEGToolGroup-${f}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const N=n[0],[C,T]=(0,l.O_)(),[k,P]=(0,r.useState)(1),[G,M]=(0,r.useState)(N.isHydrated),[O,x]=(0,r.useState)(!N.isLoaded),[A,L]=(0,r.useState)(null),[U,R]=(0,r.useState)({percentComplete:null,totalSegments:null}),V=(0,r.useRef)(null),{viewports:_,activeViewportId:H}=C,j=N.getReferenceDisplaySet(),F=function(e,t){const{SharedFunctionalGroupsSequence:[n]}=t.instance,{PixelMeasuresSequence:[s]}=n,{SpacingBetweenSlices:a,SliceThickness:r}=s,i=e.images[0],o={PatientID:i.PatientID,PatientName:i.PatientName,PatientSex:i.PatientSex,PatientAge:i.PatientAge,SliceThickness:i.SliceThickness||r,StudyDate:i.StudyDate,SeriesDescription:i.SeriesDescription,SeriesInstanceUID:i.SeriesInstanceUID,SeriesNumber:i.SeriesNumber,ManufacturerModelName:i.ManufacturerModelName,SpacingBetweenSlices:i.SpacingBetweenSlices||a};return o}(j,N);V.current={displaySet:j,metadata:F};const Y=e=>{L(e.detail.element)},q=()=>{L(null)},B=(0,r.useCallback)((()=>{C?.viewports.forEach((e=>{let{viewportId:t}=e;E.runCommand("storePresentation",{viewportId:t})}))}),[C]),Z=(0,r.useCallback)((()=>{const{component:t}=g.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return r.createElement(t,d({},e,{displaySets:[n,N],viewportOptions:{viewportType:"volume",toolGroupId:I,orientation:s.orientation,viewportId:s.viewportId},onElementEnabled:Y,onElementDisabled:q}))}),[f,N,I]),$=(0,r.useCallback)((e=>{e="left"===e?-1:1;const t=N.displaySetInstanceUID,n=b.getSegmentation(t),{segments:s}=n,a=Object.keys(s).length;let r=k+e;r>a-1?r=1:0===r&&(r=a-1),b.jumpToSegmentCenter(t,r,I),P(r)}),[k]);(0,r.useEffect)((()=>{O||m({servicesManager:p,viewportId:f,segDisplaySet:N,preHydrateCallbacks:[B]}).then((e=>{e&&M(!0)}))}),[p,f,N,O]),(0,r.useEffect)((()=>{const{unsubscribe:e}=b.subscribe(b.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===N.displaySetInstanceUID&&x(!1),e.overlappingSegments&&h.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[N]),(0,r.useEffect)((()=>{const{unsubscribe:e}=b.subscribe(b.EVENTS.SEGMENT_LOADING_COMPLETE,(e=>{let{percentComplete:t,numSegments:n}=e;R({percentComplete:t,totalSegments:n})}));return()=>{e()}}),[N]),(0,r.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=_.get(H);t.includes(n.displaySetInstanceUID)&&T.setDisplaySetsForViewport({viewportId:H,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=w.getToolGroup(I);if(!e)return e=c(w,D,I),()=>{b.removeSegmentationRepresentationFromToolGroup(I),w.destroyToolGroup(I)}}),[]),(0,r.useEffect)((()=>(M(N.isHydrated),()=>{b.removeSegmentationRepresentationFromToolGroup(I),V.current=null})),[N]);let J=null;if(!V.current||j.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(J=t.map(((e,t)=>e&&r.cloneElement(e,{viewportId:f,key:t}))));const{PatientID:z,PatientName:K,PatientSex:Q,PatientAge:W,SliceThickness:X,ManufacturerModelName:ee,StudyDate:te,SeriesDescription:ne,SpacingBetweenSlices:se}=V.current.metadata,ae=async()=>{B();const e=await(0,u.Z)({segDisplaySet:N,viewportId:f,servicesManager:p});M(e)};return r.createElement(r.Fragment,null,r.createElement(l.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:$,getStatusComponent:()=>function(e){let{isHydrated:t,onStatusClick:n}=e,s=null,a=null;const{t:o}=(0,i.$G)("Common"),c=o("LOAD");switch(t){case!0:a=()=>r.createElement(l.JO,{name:"status-alert"}),s=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:a=()=>r.createElement(l.JO,{className:"text-aqua-pale",name:"status-untracked"}),s=()=>r.createElement("div",null,"Click LOAD to load segmentation.")}const u=()=>r.createElement("div",{className:"flex h-6 cursor-default text-sm leading-6 text-white"},r.createElement("div",{className:"bg-customgray-100 flex min-w-[45px] items-center rounded-l-xl rounded-r p-1"},r.createElement(a,null),r.createElement("span",{className:"ml-1"},"SEG")),!t&&r.createElement("div",{className:"bg-primary-main hover:bg-primary-light ml-1 cursor-pointer rounded px-1.5 hover:text-black",onMouseUp:n},c));return r.createElement(r.Fragment,null,s&&r.createElement(l.u,{content:r.createElement(s,null),position:"bottom-left"},r.createElement(u,null)),!s&&r.createElement(u,null))}({isHydrated:G,onStatusClick:ae}),studyData:{label:a,useAltStyling:!0,studyDate:S(te),seriesDescription:`SEG Viewport ${ne}`,patientInformation:{patientName:K?o.default.utils.formatPN(K.Alphabetic):"",patientSex:Q||"",patientAge:W||"",MRN:z||"",thickness:X?o.utils.roundNumber(X,2):"",thicknessUnits:void 0!==X?"mm":"",spacing:void 0!==se?o.utils.roundNumber(se,2):"",scanner:ee||""}}}),r.createElement("div",{className:"relative flex h-full w-full flex-row overflow-hidden"},O&&r.createElement(l.bk,{className:"h-full w-full",totalNumbers:U.totalSegments,percentComplete:U.percentComplete,loadingText:"Loading SEG..."}),Z(),J))}g.propTypes={displaySets:a().arrayOf(a().object),viewportId:a().string.isRequired,dataSource:a().object,children:a().node,customProps:a().object},g.defaultProps={customProps:{}};const E=g}}]);
//# sourceMappingURL=451.bundle.70f7646f95aeec41ac20.js.map